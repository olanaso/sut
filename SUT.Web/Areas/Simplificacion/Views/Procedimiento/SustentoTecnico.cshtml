@using Sut.Entities;
@model Procedimiento

@{
    Sut.Security.UsuarioInfo user = ViewBag.Usuario as Sut.Security.UsuarioInfo;
    Sut.Entities.Expediente exp = ViewBag.Expediente as Sut.Entities.Expediente;
    Sut.Entities.Observacion obs = ViewBag.Observacion as Sut.Entities.Observacion;

    List<Sut.Entities.Observacion> obstecnico = ViewBag.Observaciontecnico as List<Sut.Entities.Observacion>;
    ViewBag.Icon = "fa fa-file-text-o";
    ViewBag.Title = "Sustento Técnico y Legal - " + Model.CodigoCorto;
    ViewBag.Descripcion = "";
}


@if (exp.EstadoExpediente == EstadoExpediente.Observado)
{
    <div class="box box-danger">
        <div class="box-body">
            <div class="col-sm-12 col-xs-12" style="border-color:red">

                <div class="pull-left col-sm-12 col-xs-12">

                    <fieldset class="scheduler-border">
                        <legend>
                            Información Complementaria a la Observación
                        </legend>
                        <br />
                        <div class="form-group">
                            @if (obs != null)
                            {
                                <textarea rows="5" class="form-control" id="txtaObservarExp" style="border-color:red;background:#ff00002e;"> @obs.Descripcion</textarea>
                            }
                            else
                            {<textarea rows="5" class="form-control" id="txtaObservarExp" style="border-color:red;background:#ff00002e;"> </textarea>}
                        </div>

                    </fieldset>

                </div>

            </div>
        </div>
    </div>
}

<div id="mensajes">
    @{Html.RenderPartial("_Error");}
</div>

@using (Html.BeginForm("SustentoTecnico", "Procedimiento", new { @area = "Simplificacion" }, FormMethod.Post, new { @id = "form-editar" }))
{
    @Html.HiddenFor(model => model.ProcedimientoId)
    @Html.HiddenFor(model => model.Operacion)
    @*@Html.HiddenFor(model => model.SustTecCalificacion)*@

    @Html.HiddenFor(model => model.ObsDG)
    @Html.HiddenFor(model => model.ObsDGH)
    @Html.HiddenFor(model => model.ObsSTL)
    @Html.HiddenFor(model => model.ObsSTLH)
    @Html.HiddenFor(model => model.ObsASME)
    @Html.HiddenFor(model => model.ObsASMEH)


    @Html.HiddenFor(model => model.DatosGeneralesTerminado)

    @Html.HiddenFor(model => model.SustTecnicoTerminado)
    @Html.HiddenFor(model => model.TablaAsmeTerminado)

    @Html.HiddenFor(model => model.EstadodatosEva)
    @Html.HiddenFor(model => model.EstadoInfoEva)
    @Html.HiddenFor(model => model.EstadostlEva)
    @Html.HiddenFor(model => model.EstadotablaasmeEva)

    <div class="box box-danger">
        <div class="box-body form-horizontal">
            <div class="form-group">
                <label class="col-sm-2 col-xs-12 control-label" for="Denominacion">Denominación :</label>
                <div class="col-sm-10 col-xs-12">
                    @Html.TextBoxFor(model => model.Denominacion, new { @class = "form-control", @readonly = "readonly" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 col-xs-12 control-label">Tipo :</label>
                <div class="col-sm-10 col-xs-12">
                    @Html.TipoProcedimiento(Model.TipoProcedimiento)
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 col-xs-12 control-label">Dependencia a Cargo :</label>
                <div class="col-sm-10 col-xs-12">
                    @Html.TextBoxFor(model => model.UndOrgResponsable.Nombre, new { @class = "form-control", @readonly = "readonly" })
                </div>
            </div>
            @if (@Model.CargoPordependencia != "")
            {
                <div class="form-group">
                    <label class="col-sm-2 col-xs-12 control-label">Otras Dependecias a Cargo :</label>
                    <div class="col-sm-10 col-xs-12">
                        <div>
                            @Html.TextAreaFor(model => model.CargoPordependencia, new { @style = "scroll-behavior: smooth;resize:vertical;", @class = "form-control", @readonly = "readonly", Required = true })

                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    if (Model.Operacion != OperacionExpediente.Eliminacion)
    {
        if (Model.Expediente.TipoExpediente != TipoExpediente.CargaInicial)
        {

            if (Model.Calificacion != CalificacionProcedimiento.Automatica && Model.Calificacion != CalificacionProcedimiento.SilencioPositivo && Model.TipoProcedimiento != TipoProcedimiento.Servicio)
            {
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h3 class="box-title"> Sustento Técnico de la Calificación</h3>
                    </div>
                    <div class="box-body form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">Calificación :</label>
                            <div class="col-sm-10 col-xs-12">
                                <input type="text" name="cla" value="@ViewBag.Calificacion" class="form-control" readonly />
                            </div>

                        </div>


                        @if (exp.EstadoExpediente == EstadoExpediente.Observado)
                        {
                            @*/*Inicio SustTecCalificacion*/*@
                            <div class="form-group">
                                <label class="col-sm-2 col-xs-12 control-label"></label>
                                <div class="col-sm-10 col-xs-12">


                                    @*<a class="btn btn-warning btn-xs" id="aSustentarObservarExpSustTecCalificacion"   data-placement="right" title="Sustentar Observación" href="javascript:sut.editProcedimiento.sustentarObservarExp('SustTecCalificacionSustento','divSustTecCalificacion','divSustTecCalificacionSustento','SustTecCalificacion','Calificación :',10);"><i class="fa fa-pencil-square-o"></i></a>
                                        <a class="btn btn-primary btn-xs" style="display:none" id="aGuardarSustentarExpSustTecCalificacion" data-placement="right" title="Guardar Sustento" href="javascript:sut.editProcedimiento.AsignarSustentarexp.guardarSustentarExp(@Model.ExpedienteId,@Model.ProcedimientoId,'SustTecCalificacionSustento','SustTecCalificacion','Sustento Tecnico');"><i class="fa fa-floppy-o"></i></a>
                                        <a class="btn btn-danger btn-xs" style="display:none" id="aCancelarSustentarExpSustTecCalificacion" data-placement="right" title="Quitar Sustento"  href="javascript:sut.editProcedimiento.AsignarSustentarexp.CancelarSustentarExp(@Model.ExpedienteId,@Model.ProcedimientoId,'SustTecCalificacionSustento','SustTecCalificacion','Sustento Tecnico','divSustTecCalificacionSustento');"><i class="fa fa-power-off"></i></a>*@


                                    <label id="mensajeSustTecCalificacion" class="label-primary label" style="font-size: 100%;font-weight: normal;"></label>

                                    @if (obstecnico.Count != 0)
                                    {

                                        var cont = 0;
                                        var texto1 = "";
                                        foreach (var item in obstecnico)
                                        {
                                            if (@item.Pantalla == "Sustento Tecnico" && @item.NombreCampo == "SustTecCalificacion")
                                            {
                                                cont = 1;

                                                if (@item.CodValidacion == "1")
                                                {

                                                    texto1 = @item.Descripcion;
                                                }
                                                else

                                                if (@item.CodValidacion == "4")
                                                {
                                                    <script>
                                                        window.addEventListener("load", function () {
                                                            valiarbotones('SustTecCalificacion');
                                                            document.querySelector('#mensajeSustTecCalificacion').innerText = 'Se valido con éxito';
                                                        });
                                                    </script>
                                                }
                                                else if (@item.CodValidacion == "2")
                                                {
                                                    <script>

                                                        window.addEventListener("load", function() {
                                                            sut.editProcedimiento.textoobservacion("@texto1.Replace("\n", " ")","@item.Descripcion.Replace("\n", " ")",'divSustTecCalificacion','divSustTecCalificaciondetalle','Calificación :','SustTecCalificacion1','SustTecCalificacion2',10, "@exp.EstadoExpediente",'NombreSustTecCalificacion');
                                                        });
                                                    </script>
                                                    @*/*botones unicos sustentar*/*@
                                                    <a class="btn btn-warning btn-xs" id="aSustentarObservarExpSustTecCalificacion" data-placement="right" title="Refutar Observación" href="javascript:sut.editProcedimiento.sustentarObservarExp('SustTecCalificacionSustento','divSustTecCalificacion','divSustTecCalificacionSustento','SustTecCalificacion','Calificación :',10);"><i class="fa fa-pencil-square-o"></i></a>
                                                    <a class="btn btn-primary btn-xs" style="display:none" id="aGuardarSustentarExpSustTecCalificacion" data-placement="right" title="Guardar Sustento" href="javascript:sut.editProcedimiento.AsignarSustentarexp.guardarSustentarExp(@Model.ExpedienteId,@Model.ProcedimientoId,'SustTecCalificacionSustento','SustTecCalificacion','Sustento Tecnico');"><i class="fa fa-floppy-o"></i></a>
                                                    <a class="btn btn-danger btn-xs" style="display:none" id="aCancelarSustentarExpSustTecCalificacion" data-placement="right" title="Quitar Sustento" href="javascript:sut.editProcedimiento.AsignarSustentarexp.CancelarSustentarExp(@Model.ExpedienteId,@Model.ProcedimientoId,'SustTecCalificacionSustento','SustTecCalificacion','Sustento Tecnico','divSustTecCalificacionSustento');"><i class="fa fa-power-off"></i></a>
                                                    @*/*botones Generados*/*@
                                                }

                                                else if (@item.CodValidacion == "5")
                                                {
                                                    <script>
                                                        window.addEventListener("load", function () {
                                                            canceladobotones('SustTecCalificacion');
                                                        });
                                                    </script>
                                                }
                                                else if (@item.CodValidacion == "3")
                                                {
                                                    <script>

                                                        window.addEventListener("load", function() {
                                                            sustentobotonesunidad('SustTecCalificacion');
                                                            document.querySelector('#mensajeSustTecCalificacion').innerText = 'Se refuto con éxito';
                                                            sut.editProcedimiento.textosustentounidad("@item.Descripcion.Replace("\n", " ")",'divSustTecCalificacion','divSustTecCalificacionSustento','Calificación :','SustTecCalificacionSustento',10);
                                                        });
                                                    </script>
                                                }
                                            }
                                        }
                                        @*if (cont == 0)
                                            {
                                                <script>
                                                    window.addEventListener("load", function () {
                                                        //canceladobotonessustento('SustTecCalificacion');
                                                    });
                                                </script>
                                            }*@
                                    }

                                </div>
                            </div>
                            <div id="divSustTecCalificacion" class="form-group">
                            </div>
                            @*/*Fin*/*@
                        }

                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">Sustento de la Calificación :</label>
                            <div class="col-sm-10 col-xs-12">
                                @if (Model.CodigoACR != "0")
                                {
                                    @*@Html.TextAreaFor(model => model.SustTecCalificacion, new { @class = "form-control", @readonly = "readonly" })*@
                                    @Html.TextAreaFor(model => model.SustTecCalificacion, new { @class = "form-control", Required = true })
                                }
                                else
                                {
                                    @Html.TextAreaFor(model => model.SustTecCalificacion, new { @class = "form-control", Required = true })
                                }
                            </div>
                        </div>


                    </div>
                </div>
            }

            if (Model.PlazoAtencion > 30)
            {
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h3 class="box-title"> Sustento Técnico del Plazo de Atención</h3>
                    </div>

                    <div class="box-body form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label" for="PlazoAtencion">Plazo de Atención :</label>
                            <div>
                                @if (Model.Activar == 1 || Model.listplazoatencion.Count() > 0)
                                {
                                    <div class="col-sm-2 col-xs-1">
                                        @Html.TextBoxFor(model => model.PlazoAtencionDes, new { @class = "form-control", @norequired = true, Required = true, @readonly = true })
                                    </div>
                                    <div class="col-sm-1 col-xs-1">
                                        @Html.TextBoxFor(model => model.PlazoAtencion, new { @class = "form-control", @type = "number", min = 0, @readonly = true })
                                    </div>
                                }
                                else
                                {
                                    <div class="col-sm-3 col-xs-1">
                                        @Html.TextBoxFor(model => model.PlazoAtencion, new { @class = "form-control", @type = "number", min = 0, @readonly = true })

                                    </div>
                                }
                                <div class="col-sm-1 col-xs-1">

                                    @Html.HiddenFor(model => model.TipoPlazo)
                                    @{
                                        string tipoplazo = string.Empty;
                                        List<SelectListItem> lsttipoplazo = ViewBag.tipoplazo as List<SelectListItem>;
                                        tipoplazo = lsttipoplazo.First(x => x.Value == ((short)Model.TipoPlazo).ToString()).Text;
                                    }
                                    @Html.TextBox("Nombretipoplazo", tipoplazo, new { @class = "form-control", @readonly = true })
                                </div>
                            </div>

                        </div>





                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label" for="PlazoAtencion">Base legal del Plazo de Atención:</label>
                            <div class="col-sm-10 col-xs-12">
                                @Html.TextAreaFor(model => model.SustentoPlazo, new { @class = "form-control", Required = true })
                                @*@Html.TextAreaFor(model => model.SustentoPlazo, new { @class = "form-control", @readonly = "readonly" })*@
                            </div>
                        </div>
                        @if (Model.listplazoatencion.Count() > 0)
                        {
                            <div class="form-group">
                                <label class="col-sm-2 col-xs-12 control-label" for="PlazoAtencion"></label>
                                <div class="col-sm-10 col-xs-12">
                                    <table id="tblPlazoAtencion" data-formtable="0" class="table table-condensed table-bordered table-striped" style="margin-bottom: 0px;">
                                        <thead>
                                            <tr>
                                                <th style="width:40px;"></th>
                                                <th style="width:400px;">Descripción</th>
                                                <th style="width:60px;">Plazo</th>
                                                <th style="width:90px;">Tipo Plazo</th>
                                                <th style="width:800px;">Base legal del Plazo de Atención</th>
                                                <th style="width:10px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (Model.listplazoatencion.Count() > 0)
                                            {
                                                int i = 0;
                                                foreach (PlazoAtencion p in Model.listplazoatencion)
                                                {
                                                    <tr>
                                                        <td style="width:40px;">@MvcHtmlString.Create((++i).ToString())</td>
                                                        <td style="width:400px;">@p.Descripcion</td>
                                                        <td style="width:60px;">@p.Plazo</td>
                                                        <td style="width:90px;">@p.TipoPlazo </td>
                                                        <td style="width:90px;">@p.Sustento </td>
                                                        <td style="width:10px;">
                                                            @if (@user.rolmenu[0].Editar == true)
                                                            {
                                                                <a href="javascript:sut.editProcedimiento.BaseLegal.editPlazoAtencion(1,@p.PlazoAtencionId,@Model.ProcedimientoId)" class="btn btn-xs btn-success"><i class="fa fa-pencil"></i> </a>
                                                            }

                                                        </td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
            else if (Model.listplazoatencion.Count() > 0)
            {
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h3 class="box-title"> Sustento Técnico del Plazo de Atención</h3>
                    </div>

                    <div class="box-body form-horizontal">

                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label" for="PlazoAtencion"></label>
                            <div class="col-sm-10 col-xs-12">
                                <table id="tblPlazoAtencion" data-formtable="0" class="table table-condensed table-bordered table-striped" style="margin-bottom: 0px;">
                                    <thead>
                                        <tr>
                                            <th style="width:40px;"></th>
                                            <th style="width:400px;">Descripción</th>
                                            <th style="width:60px;">Plazo</th>
                                            <th style="width:90px;">Tipo Plazo</th>
                                            <th style="width:800px;">Base legal del Plazo de Atención</th>
                                            <th style="width:10px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.listplazoatencion.Count() > 0)
                                        {
                                            int i = 0;
                                            foreach (PlazoAtencion p in Model.listplazoatencion)
                                            {
                                                <tr>
                                                    <td style="width:40px;">@MvcHtmlString.Create((++i).ToString())</td>
                                                    <td style="width:400px;">@p.Descripcion</td>
                                                    <td style="width:60px;">@p.Plazo</td>
                                                    <td style="width:90px;">@p.TipoPlazo </td>
                                                    <td style="width:90px;">@p.Sustento </td>
                                                    <td style="width:10px;">
                                                        @if (@user.rolmenu[0].Editar == true)
                                                        {
                                                            <a href="javascript:sut.editProcedimiento.BaseLegal.editPlazoAtencion(1,@p.PlazoAtencionId,@Model.ProcedimientoId)" class="btn btn-xs btn-success"><i class="fa fa-pencil"></i> </a>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>

                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            }


        }

        <div class="box box-default">
            <div class="box-header with-border">
                <h3 class="box-title"> Sustento Técnico-Legal de los Requisitos</h3>
            </div>
            <div class="box-body form-horizontal">
                <h3>Requisitos Generales</h3>
                <br />
                <div class="table-responsive">

                    <table id="tblRequisito" class="table table-condensed table-bordered table-striped" style="margin-bottom: 0px;">
                        <thead>
                            <tr>
                                <th style="width:40px;">
                                </th>
                                <th style="width:30%">Nombre</th>
                                <th>Sustento Legal</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Requisito.Count > 0)
                            {
                                for (int i = 0; i < Model.Requisito.Count; i++)
                                {
                                    if (Model.Requisito[i].TipoRequisito == TipoRequisito.General)
                                    {


                                        if (exp.EstadoExpediente == EstadoExpediente.Observado)
                                        {
                                            <tr>
                                                <td colspan="5">

                                                    @*/*Inicio TecnicoRequisitos*/*@
                                                    <div>
                                                        <div>
                                                            @*@if (exp.EstadoExpediente == EstadoExpediente.Observado)
                                                                {

                                                                    <a class="btn btn-warning btn-xs" id="aSustentarObservarExpRequisitos_@i"   data-placement="right" title="Sustentar Observación" href="javascript:sut.editProcedimiento.sustentarObservarExpRequisitos(@i);"><i class="fa fa-pencil-square-o"></i></a>
                                                                    <a class="btn btn-primary btn-xs" style="display:none" id="aGuardarSustentarExpRequisitos_@i" data-placement="right" title="Guardar Sustento" href="javascript:sut.editProcedimiento.guardarSustentarExpRequisitos(@Model.ExpedienteId,@Model.ProcedimientoId,@i,@Model.Requisito[i].RequisitoId);"><i class="fa fa-floppy-o"></i></a>
                                                                    <a class="btn btn-danger btn-xs" style="display:none" id="aCancelarSustentarExpRequisitos_@i" data-placement="right" title="Quitar Sustento"  href="javascript:sut.editProcedimiento.CancelarSustentarExpRequisitos(@Model.ExpedienteId,@Model.ProcedimientoId,@i,@Model.Requisito[i].RequisitoId);"><i class="fa fa-power-off"></i></a>



                                                                }*@
                                                            <label id="mensajeTecnicoRequisitos_@i" class="label-primary label" style="font-size: 100%;font-weight: normal;"></label>

                                                            @if (obstecnico.Count != 0)
                                                            {
                                                                var cont = 0;
                                                                var texto1 = "";
                                                                foreach (var item in obstecnico)
                                                                {
                                                                    var nombre = "NombredelosTecnicoRequisitos" + i;

                                                                    if (@item.Pantalla == "Sustento Tecnico" && @item.NombreCampo == nombre)
                                                                    {
                                                                        cont = 1;

                                                                        if (@item.CodValidacion == "1")
                                                                        {

                                                                            texto1 = @item.Descripcion;
                                                                        }
                                                                        else

                                                                        if (@item.CodValidacion == "4")
                                                                        {
                                                                            <script>
                                                                                window.addEventListener("load", function () {
                                                                                    valiarbotonesModalidad('TecnicoRequisitos', @i);
                                                                                    $("#mensajeTecnicoRequisitos_" + @i).show();
                                                                                    document.querySelector("#mensajeTecnicoRequisitos_" + @i).innerText = 'Se valido con éxito';
                                                                                });
                                                                            </script>
                                                                        }
                                                                        else if (@item.CodValidacion == "2")
                                                                        {
                                                                            <script>

                                                                                window.addEventListener("load", function() {
                                                                                    sut.editProcedimiento.textoobservacionTecnicoRequisitos("@texto1.Replace("\n", " ")", "@item.Descripcion.Replace("\n", " ")", 4, "@exp.EstadoExpediente", @i);

                                                                                });
                                                                            </script>
                                                                            <a class="btn btn-warning btn-xs" id="aSustentarObservarExpRequisitos_@i" data-placement="right" title="Refutar Observación" href="javascript:sut.editProcedimiento.sustentarObservarExpRequisitos(@i);"><i class="fa fa-pencil-square-o"></i></a>
                                                                            <a class="btn btn-primary btn-xs" style="display:none" id="aGuardarSustentarExpRequisitos_@i" data-placement="right" title="Guardar Sustento" href="javascript:sut.editProcedimiento.guardarSustentarExpRequisitos(@Model.ExpedienteId,@Model.ProcedimientoId,@i,@Model.Requisito[i].RequisitoId);"><i class="fa fa-floppy-o"></i></a>
                                                                            <a class="btn btn-danger btn-xs" style="display:none" id="aCancelarSustentarExpRequisitos_@i" data-placement="right" title="Quitar Sustento" href="javascript:sut.editProcedimiento.CancelarSustentarExpRequisitos(@Model.ExpedienteId,@Model.ProcedimientoId,@i,@Model.Requisito[i].RequisitoId);"><i class="fa fa-power-off"></i></a>

                                                                        }

                                                                        else if (@item.CodValidacion == "5")
                                                                        {
                                                                            <script>
                                                                                window.addEventListener("load", function () {
                                                                                    canceladobotonesModalidad('TecnicoRequisitos');
                                                                                });
                                                                            </script>
                                                                        }
                                                                        else if (@item.CodValidacion == "3")
                                                                        {
                                                                            <script>


                                                                                window.addEventListener("load", function() {
                                                                                    sustentobotones('Requisitos',@i);
                                                                                    document.querySelector("#mensajeTecnicoRequisitos_" + @i).innerText  = 'Se refuto con éxito';
                                                                                    sut.editProcedimiento.textosustento("@item.Descripcion.Replace("\n", " ")", 4, "@exp.EstadoExpediente", @i);
                                                                                });
                                                                            </script>
                                                                        }
                                                                    }
                                                                }
                                                            }

                                                        </div>
                                                    </div>
                                                    <div id="divTecnicoRequisitos">
                                                        <table id="divTecnicoRequisitos0_@i" class="table table-condensed table-bordered table-striped" style="margin-bottom: 0px;">
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                    @*/*Fin*/*@
                                                </td>
                                            </tr>

                                        }
                                        <tr id="trTecnicoRequisitos_@i">
                                            <td rowspan="2" style="text-align: right">
                                                @*@MvcHtmlString.Create((i + 1).ToString())*@
                                                @Model.Requisito[i].RecNum
                                                @Html.HiddenFor(model => model.Requisito[i].RequisitoId)
                                            </td>
                                            <td>@Model.Requisito[i].Nombre</td>
                                            <td rowspan="2">
                                                @Html.HiddenFor(model => model.Requisito[i].BaseLegalId)
                                                @Html.HiddenFor(model => model.Requisito[i].BaseLegal.BaseLegalId)
                                                <div class="table-responsive">
                                                    <table id="tblBaseLegal_@MvcHtmlString.Create(i.ToString())" class="table table-condensed table-bordered table-striped" style="margin-bottom: 0px;">
                                                        <thead>
                                                            <tr>
                                                                <th style="width:80px;">
                                                                    @if (@user.rolmenu[0].Agregar == true)
                                                                    {
                                                                        <a href="javascript:sut.editProcedimiento.BaseLegal.edit(@MvcHtmlString.Create(i.ToString()),null,@Model.Requisito[i].RequisitoId)" id="idagregarbaselegal_@i" class="btn btn-success btn-xs"><i class="fa fa-plus"></i> Agregar</a>
                                                                    }
                                                                </th>
                                                                <th style="width:60px;">Artículo</th>
                                                                <th>Denominación</th>
                                                                <th style="width:100px;">Tipo de Norma</th>
                                                                <th style="width:60px;">Número</th>
                                                                <th style="width:100px;">Fecha de Publicación en El Diario El Peruano</th>

                                                                @*<th style="width:100px;">Documento</th>*@
                                                                <th style="width:50px;"></th>
                                                                <th style="width:50px;"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                @*Sustento Técnico*@



                                                @if ( Model.CodigoACR == "0" && (Model.TipoProcedimiento != TipoProcedimiento.Estandar && Model.TipoProcedimiento != TipoProcedimiento.EstandarServicio))
                                                {
                                                    <g>¿Se puede eliminar el requisito por no contribuir al propósito del PA?, si la respuesta es NO, sustentar como contribuye al PA</g>

                                                    if (user.Rol == 1)
                                                    {@Html.TextAreaFor(model => model.Requisito[i].SustentoTecnico, new { @class = "form-control" })}
                                                else
                                                { @Html.TextAreaFor(model => model.Requisito[i].SustentoTecnico, new { @class = "form-control", @required = true })}
                                        }




                                            </td>
                                        </tr>
                                    }
                                }
                            }
                            else
                            {
                                <tr><td colspan="4" style="font-weight:bold; text-align:center;">NO EXISTEN REGISTROS</td></tr>
                            }
                        </tbody>
                    </table>
                </div>
                <br />
                <h3>Nota:</h3>
                <br />
                <div class="table-responsive">
                    <table id="tblRequisito" class="table table-condensed">
                        <thead>
                            <tr>
                                <th style="width:40px;">

                                </th>
                                <th style="width:30%">Nombre</th>
                                <th>Sustento Legal</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Requisito.Count > 0)
                            {
                                for (int i = 0; i < Model.Requisito.Count; i++)
                                {
                                    if (Model.Requisito[i].TipoRequisito == TipoRequisito.Especifico)
                                    {

                                        if (exp.EstadoExpediente == EstadoExpediente.Observado)
                                        {
                                            <tr>
                                                <td colspan="5">

                                                    @*/*Inicio TecnicoRequisitos*/*@
                                                    <div>
                                                        <div>
                                                            @if (exp.EstadoExpediente == EstadoExpediente.Observado)
                                                            {

                                                                @*<a class="btn btn-warning btn-xs" id="aSustentarObservarExpRequisitos_@i"   data-placement="right" title="Sustentar Observación" href="javascript:sut.editProcedimiento.sustentarObservarExpRequisitos(@i);"><i class="fa fa-pencil-square-o"></i></a>
                                                                    <a class="btn btn-primary btn-xs" style="display:none" id="aGuardarSustentarExpRequisitos_@i" data-placement="right" title="Guardar Sustento" href="javascript:sut.editProcedimiento.guardarSustentarExpRequisitos(@Model.ExpedienteId,@Model.ProcedimientoId,@i,@Model.Requisito[i].RequisitoId);"><i class="fa fa-floppy-o"></i></a>
                                                                    <a class="btn btn-danger btn-xs" style="display:none" id="aCancelarSustentarExpRequisitos_@i" data-placement="right" title="Quitar Sustento"  href="javascript:sut.editProcedimiento.CancelarSustentarExpRequisitos(@Model.ExpedienteId,@Model.ProcedimientoId,@i,@Model.Requisito[i].RequisitoId);"><i class="fa fa-power-off"></i></a>*@



                                                            }
                                                            <label id="mensajeTecnicoRequisitos_@i" class="label-primary label" style="font-size: 100%;font-weight: normal;"></label>

                                                            @if (obstecnico.Count != 0)
                                                            {
                                                                var cont = 0;
                                                                var texto1 = "";
                                                                foreach (var item in obstecnico)
                                                                {
                                                                    var nombre = "NombredelosTecnicoRequisitos" + i;

                                                                    if (@item.Pantalla == "Sustento Tecnico" && @item.NombreCampo == nombre)
                                                                    {
                                                                        cont = 1;

                                                                        if (@item.CodValidacion == "1")
                                                                        {

                                                                            texto1 = @item.Descripcion;
                                                                        }
                                                                        else

                                                                        if (@item.CodValidacion == "4")
                                                                        {
                                                                            <script>
                                                                                window.addEventListener("load", function () {
                                                                                    valiarbotonesModalidad('TecnicoRequisitos', @i);
                                                                                    $("#mensajeTecnicoRequisitos_" + @i).show();
                                                                                    document.querySelector("#mensajeTecnicoRequisitos_" + @i).innerText = 'Se valido con éxito';
                                                                                });
                                                                            </script>
                                                                        }
                                                                        else if (@item.CodValidacion == "2")
                                                                        {
                                                                            <script>

                                                                                window.addEventListener("load", function() {
                                                                                    sut.editProcedimiento.textoobservacionTecnicoRequisitos("@texto1.Replace("\n", " ")", "@item.Descripcion.Replace("\n", " ")", 4, "@exp.EstadoExpediente", @i);

                                                                                });
                                                                            </script>
                                                                            <a class="btn btn-warning btn-xs" id="aSustentarObservarExpRequisitos_@i" data-placement="right" title="Refutar Observación" href="javascript:sut.editProcedimiento.sustentarObservarExpRequisitos(@i);"><i class="fa fa-pencil-square-o"></i></a>
                                                                            <a class="btn btn-primary btn-xs" style="display:none" id="aGuardarSustentarExpRequisitos_@i" data-placement="right" title="Guardar Sustento" href="javascript:sut.editProcedimiento.guardarSustentarExpRequisitos(@Model.ExpedienteId,@Model.ProcedimientoId,@i,@Model.Requisito[i].RequisitoId);"><i class="fa fa-floppy-o"></i></a>
                                                                            <a class="btn btn-danger btn-xs" style="display:none" id="aCancelarSustentarExpRequisitos_@i" data-placement="right" title="Quitar Sustento" href="javascript:sut.editProcedimiento.CancelarSustentarExpRequisitos(@Model.ExpedienteId,@Model.ProcedimientoId,@i,@Model.Requisito[i].RequisitoId);"><i class="fa fa-power-off"></i></a>

                                                                        }

                                                                        else if (@item.CodValidacion == "5")
                                                                        {
                                                                            <script>
                                                                                window.addEventListener("load", function () {
                                                                                    canceladobotonesModalidad('TecnicoRequisitos');
                                                                                });
                                                                            </script>
                                                                        }
                                                                        else if (@item.CodValidacion == "3")
                                                                        {
                                                                            <script>


                                                                                window.addEventListener("load", function() {
                                                                                    sustentobotones('Requisitos',@i);
                                                                                    document.querySelector("#mensajeTecnicoRequisitos_" + @i).innerText  = 'Se refuto con éxito';
                                                                                    sut.editProcedimiento.textosustento("@item.Descripcion.Replace("\n", " ")", 4, "@exp.EstadoExpediente", @i);
                                                                                });
                                                                            </script>
                                                                        }
                                                                    }
                                                                }
                                                            }

                                                        </div>
                                                    </div>
                                                    <div id="divTecnicoRequisitos">
                                                        <table id="divTecnicoRequisitos0_@i" class="table table-condensed table-bordered table-striped" style="margin-bottom: 0px;">
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                    @*/*Fin*/*@
                                                </td>
                                            </tr>

                                        }


                                        <tr>
                                            <td rowspan="2" style="text-align: right">
                                                @*@MvcHtmlString.Create((i + 1).ToString())*@
                                                @Model.Requisito[i].RecNum

                                                @Html.HiddenFor(model => model.Requisito[i].RequisitoId)
                                            </td>
                                            <td>@Model.Requisito[i].Nombre</td>
                                            <td rowspan="2">
                                                @Html.HiddenFor(model => model.Requisito[i].BaseLegalId)
                                                @Html.HiddenFor(model => model.Requisito[i].BaseLegal.BaseLegalId)
                                                <div class="table-responsive">
                                                    <table id="tblBaseLegal_@MvcHtmlString.Create(i.ToString())" class="table table-condensed table-bordered table-striped" style="margin-bottom: 0px;">
                                                        <thead>
                                                            <tr>
                                                                <th style="width:80px;">
                                                                    @if (@user.rolmenu[0].Agregar == true)
                                                                    {
                                                                        <a href="javascript:sut.editProcedimiento.BaseLegal.edit(@MvcHtmlString.Create(i.ToString()),null,@Model.Requisito[i].RequisitoId)" class="btn btn-success btn-xs"><i class="fa fa-plus"></i> Agregar</a>
                                                                    }
                                                                </th>
                                                                <th style="width:60px;">Artículo</th>
                                                                <th>Denominación</th>
                                                                <th style="width:100px;">Tipo de Norma</th>
                                                                <th style="width:60px;">Número</th>
                                                                <th style="width:100px;">Fecha de Publicación en El Diario El Peruano</th>
                                                                @*<th style="width:100px;">Documento</th>*@
                                                                <th style="width:50px;"></th>
                                                                <th style="width:50px;"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                @*Sustento Técnico*@
                                                @if (Model.TipoProcedimiento != TipoProcedimiento.Estandar || Model.CodigoACR != "0")
                                                {
                                                    @*<g>¿Se puede eliminar el requisito por no contribuir al propósito del PA?,  si la respuesta es NO, sustentar como contribuye al PA</g>*@
                                                }

                                                @*@Html.TextAreaFor(model => model.Requisito[i].SustentoTecnico, new { @class = "form-control" })*@
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                            else
                            {
                                <tr><td colspan="4" style="font-weight:bold; text-align:center;">NO EXISTEN REGISTROS</td></tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="box box-default" style="display:none;visibility:collapse;">
            <div class="box-header with-border">
                <h3 class="box-title"> Tablas ASME del Procedimiento/Servicio</h3>
            </div>
            <div class="box-body">
                <div class="table-responsive">
                    <table id="tblSustento" class="table table-condensed table-bordered table-striped" style="margin-bottom: 0px;">
                        <thead>
                            <tr>
                                <th style="width:40px;">

                                </th>
                                <th style="width:120px;">Código</th>
                                <th>Descripción</th>
                                <th style="width:50px;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.TablaAsme.Count > 0)
                            {
                                for (int i = 0; i < Model.TablaAsme.Count; i++)
                                {
                                    <tr>
                                        <td>
                                            @MvcHtmlString.Create((i + 1).ToString())
                                        </td>
                                        <td>@Model.TablaAsme[i].Codigo</td>
                                        <td>@Model.TablaAsme[i].Descripcion</td>
                                        <td>
                                            @*<a class="btn btn-success btn-xs" href="javascript:window.location='/Simplificacion/TablaAsme/Editar/@Model.TablaAsme[i].TablaAsmeId'"><i class="fa fa-table"></i></a>*@
                                            <a class="btn btn-success btn-xs" href="javascript:window.location='@Url.Content("~/Simplificacion/TablaAsme/Editar/")@Model.TablaAsme[i].TablaAsmeId'"><i class="fa fa-table"></i></a>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr><td colspan="4" style="font-weight:bold; text-align:center;">NO EXISTEN REGISTROS</td></tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="box box-default">
            <div class="box-header with-border">
                <h3 class="box-title"> Sustento Técnico de los Requisitos</h3>
            </div>
            <div class="box-body">
                @Html.TextAreaFor(model => model.SustentoEliminacion, new { @class = "form-control" })
            </div>
        </div>
    }


    @*<div class="box box-default">
            <div class="box-body">
                <div class="btn-group pull-right">
                    <a href="/Simplificacion/Expediente/Editar/@Model.ExpedienteId" class="btn btn-danger"><i class="fa fa-arrow-left"></i> Volver</a>
                    <a href="javascript:sut.editProcedimiento.guardar()" class="btn btn-primary"><i class="fa fa-save"></i> Guardar</a>
                    @if (ViewBag.User.Rol == (short)Rol.Coordinador || ViewBag.User.Rol == (short)Rol.Administrador)
                    {
                        <a href="javascript:sut.editProcedimiento.terminar()" class="btn btn-success"><i class="fa fa-check"></i> Terminar</a>
                    }


                </div>
            </div>
        </div>*@

}

<div style="position: fixed;right: 15px;top: 60px; margin-bottom: 0;z-index: 5;">

    @*<a href="/Simplificacion/Expediente/Editar/@Model.ExpedienteId" class="btn btn-danger"><i class="fa fa-arrow-left"></i> Volver</a>*@
    <a href="javascript:sut.editProcedimiento.AtrasPA(@Model.ExpedienteId,@Model.ExplorarNum)" class="btn btn-danger"><i class="fa fa-id-card-o"></i> ATRAS </a>
    <a href="javascript:sut.editProcedimiento.SiguientePA(@Model.ExpedienteId,@Model.ExplorarNum)" class="btn btn-danger"><i class="fa fa-id-card-o"></i> SIGUIENTE </a>

    <a href="@Url.Content("~/Simplificacion/Procedimiento/InformacionCiudadano/")@Model.ProcedimientoId" class="btn btn-facebook"><i class="fa fa-id-card-o"></i> Inf. Ciudadano </a>
    <a href="@Url.Content("~/Simplificacion/Procedimiento/DatosGenerales/")@Model.ProcedimientoId" class="btn btn-facebook"><i class="fa fa-id-card-o"></i> Ir Datos Generales </a>
    @if (Model.Expediente.TipoExpediente == TipoExpediente.ExpedienteRegular)
    {
        <a href="#" class="btn btn-success"><i class="fa fa-id-card-o"></i>  Sus. Tec. Legal</a>
        <a href="@Url.Content("~/Simplificacion/Procedimiento/TablaAsme/")@Model.ProcedimientoId" class="btn btn-facebook"><i class="fa fa-table"></i> Ir Tabla Asme</a>
    }

    <a href="@Url.Content("~/Simplificacion/Expediente/Editar/")@Model.ExpedienteId" class="btn btn-danger"><i class="fa fa-arrow-left"></i> Volver</a>
    @if (Model.Expediente.EstadoExpediente != EstadoExpediente.Aprobado && ViewBag.User.Rol == (short)Rol.Administrador)
    {
        if (@user.rolmenu[0].Guardar == true)
        {
            <a href="javascript:sut.editProcedimiento.guardarEstandar()" class="btn btn-primary"><i class="fa fa-save"></i> Guardar</a>
        }
    }
    else
    {
        if (@user.rolmenu[0].Guardar == true)
        {
            <a href="javascript:sut.editProcedimiento.guardar()" class="btn btn-primary"><i class="fa fa-save"></i> Guardar</a>
        }
    }
    @if (@user.rolmenu[0].Terminar == true)
    {
        <a href="javascript:sut.editProcedimiento.terminar()" class="btn btn-success"><i class="fa fa-check"></i> Terminar</a>
    }
</div>

<div class="modal fade" id="modal-ventana" data-backdrop="static" data-keyboard="false">
    <div id="ventana-container">

    </div>
</div>



<div class="minmaxConayuda">
    <div class="modal fade mymodal" id="modalAyudaAvatar1">
        <div class="modal-dialog  ">
            <div class="modal-content">
                <div class="modal-body" id="contenido" style="padding:0px">
                    <div class="bar-title" id="tituloocultar">
                        <a class="close modalMinimize" style="padding:110px; right: 20px;  top: -100px; background: transparent"> <i class='fa fa-clone '></i> </a>
                        <span>
                            <h3 id="ihtitulo1" style="font-size: x-large;text-align: center;font-family: initial;"> Hola @user.Nombres </h3>
                        </span>
                    </div>
                    <div>
                        <div id="idtitulo1" style="text-align:left">
                            <div class="col-sm-3 col-xs-2">
                                <a class="modalMinimize" title="Minimizar" style="color:black"> <i class='fa fa-minus fa-2x'></i> </a>
                                <img src="~/dist/img/hola.png" class="img-rounded" alt="Cinque Terre" />
                            </div>
                            <div class="caja col-sm-5" id="mensaje1" style="display: none; width:409px;height:100%;top:137px">
                                <sp style="text-align: left;font-family: initial;"> Clic </sp>
                                <a class="btn btn-success btn-xs" href="#"><i class="fa fa-plus"></i> Guardar</a>
                                <l style="text-align: left;font-family: initial;">Una vez que complete el registro ¡Suerte!</l>
                            </div>
                            <div class="caja col-sm-5" id="mensaje2" style=" width:440px;height:100%;top:103px">
                                <j2 style="text-align: left;font-family: initial;">Completa tu información solicitada y avancemos al siguiente paso. Clic </j2>
                                <a id="clic" style="display: none;" class="btn btn-success btn-xs" href="#"><i class="fa fa-plus"></i> Guardar</a>
                                <l1 style="text-align: left;font-family: initial;"> y luego clic en "VOLVER" Para continuar. ¡Tú puedes! </l1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="minmaxCon"></div>



@section Style {
    <style>
        table thead tr th {
            vertical-align: middle;
        }

        fieldset.scheduler-border {
            border: 1px groove #ddd !important;
            padding: 0 1.4em 0 1.4em !important;
            margin: 0 0 1.5em 0 !important;
            -webkit-box-shadow: 0px 0px 0px 0px #000;
            box-shadow: 0px 0px 0px 0px #000;
        }

        .scheduler-border legend {
            font-size: 1.2em !important;
            font-weight: bold !important;
            text-align: left !important;
            width: auto !important;
            margin-bottom: 0px !important;
            padding: 0px !important;
            border-bottom: none;
        }
    </style>
}

@section Script {
    <script>

        sut.editProcedimiento = {


            SiguientePA: (Expediente, ExplorarNum) => {
                debugger;
                $.ajax({
                    type: "GET",
                    url: '@Url.Content("~/Simplificacion/Procedimiento/SiguientePA")',
                    data: { pExpediente: Expediente, pExplorarNum: ExplorarNum  },
                    cache: false,
                    beforeSend: () => {
                        sut.wait.modal('ventana-container');
                        $('#modal-ventana').modal('show');
                    },
                    success: (data) => {
                        debugger;
                        $('#modal-ventana').modal('hide');

                            if (data.estado == 0) {

                                sut.msg.msgUsuario('No existe PA para Avanzar', 'Alerta');
                            } else
                            {
                                //~/Simplificacion/Procedimiento / InformacionCiudadano /
                                window.location = '/Simplificacion/Procedimiento/InformacionCiudadano/' + data.estado;
                            }



                    },
                    error: (result) => {
                        $('#modal-ventana').modal('hide');
                        sut.error.show('mensajes', result.responseText);
                    },
                    statusCode: {
                        203: () => { window.location.reload(); }
                    }
                });
            },

            AtrasPA: (Expediente, ExplorarNum) => {
                debugger;
                $.ajax({
                    type: "GET",
                    url: '@Url.Content("~/Simplificacion/Procedimiento/AtrasPA")',
                    data: { pExpediente: Expediente, pExplorarNum: ExplorarNum  },
                    cache: false,
                    beforeSend: () => {
                        sut.wait.modal('ventana-container');
                        $('#modal-ventana').modal('show');
                    },
                    success: (data) => {
                           debugger;
                        $('#modal-ventana').modal('hide');
                            if (data.estado == 0) {

                                sut.msg.msgUsuario('No existe PA para retroceder', 'Alerta');
                            } else
                            {
                                //~/Simplificacion/Procedimiento / InformacionCiudadano /
                                window.location = '/Simplificacion/Procedimiento/InformacionCiudadano/' + data.estado;
                            }
                    },
                    error: (result) => {
                        $('#modal-ventana').modal('hide');
                        sut.error.show('mensajes', result.responseText);
                    },
                    statusCode: {
                        203: () => { window.location.reload(); }
                    }
                });
            },
            BaseLegal: {
                datavalidar: @Html.Raw(ViewBag.ListaBaseLegalvalidar != null ? ViewBag.ListaBaseLegalvalidar : "[]") ,
                data: @Html.Raw(ViewBag.ListaBaseLegal != null ? ViewBag.ListaBaseLegal : "[]") ,
                init: () => {
                    sut.editProcedimiento.BaseLegal.generar();
                },
                editPlazoAtencion: (pantalla,PlazoAtencionId,ProcedimientoId) => {
                    var model = {};
                    debugger;

                    var tabla = "";

                    //model['nuevo'] = indexForm == null ? 1 : 0;
                    //model['indexForm'] = indexForm == null ? 0 : indexForm;
                    model['indexTablaAsmeId'] = PlazoAtencionId;
                    model['indexProcedimientoId'] = ProcedimientoId;
                    model['pantalla'] = pantalla;



                    $.ajax({
                        type: "GET",
                        //url: '/Simplificacion/Procedimiento/EditarFormulario',
                        url: '@Url.Content("~/Simplificacion/Procedimiento/EditarPlazoAtencion")',
                        data: model,
                        cache: false,
                        beforeSend: function () {
                            sut.wait.modal('ventana-container');
                            $('#modal-ventana').modal('show');
                        },
                        success: function (data) {
                            $('#ventana-container').html(data);
                        },
                        error: function (result) {
                            $('#modal-ventana').modal('hide');
                            sut.error.show('mensajes', result.responseText);
                        }
                    });
                },
                edit: (k, index,requisito) => {
                    debugger;
                    var model = {};
                    if (index != null) {
                        var r = sut.editProcedimiento.BaseLegal.data[k][index];
                        console.log(r);
                        model['model.BaseLegalNormaId'] = r.BaseLegalNormaId;
                        model['model.TipoBaseLegal'] = r.TipoBaseLegal;
                        model['model.NormaId'] = r.NormaId;
                        model['model.Descripcion'] = r.Descripcion == 'null' ? '' : r.Descripcion;
                        model['model.TipoNormaId'] = r.TipoNormaId;
                        model['model.Numero'] = r.Numero;
                        model['model.FechaPublicacion'] = r.FechaPublicacion;
                        model['model.Articulo'] = r.Articulo;
                        model['model.Url'] = r.Url == 'null' ? '' : r.Url;
                        model['model.ArchivoAdjuntoId'] = r.ArchivoAdjuntoId;
                        model['model.EstadoACR'] = r.EstadoACR;
                        model['model.DescripcionACR'] = r.DescripcionACR;
                    }

                    model['nuevo'] = index == null ? 1 : 0;
                    model['index'] = index == null ? 0 : index;
                    model['fnAdd'] = sut.string.format('sut.editProcedimiento.BaseLegal.add({0})', k);
                    model['ProcedimientoId'] = @Model.ProcedimientoId;
                    model['CodigoACR'] = @Model.CodigoACR;
                    model['requisito'] = requisito;
                    var base=sut.editProcedimiento.BaseLegal.data[k];
                    model['cantidad'] = base.length;



                    $.ajax({
                        type: "POST",
                        //url: '/General/BaseLegal/EditarDetalle',
                        url: '@Url.Content("~/General/BaseLegal/EditarDetalle")',
                        data: model,
                        cache: false,
                        beforeSend: function () {
                            sut.wait.modal('ventana-container');
                            $('#modal-ventana').modal('show');
                        },
                        success: function (data) {
                            $('#ventana-container').html(data);
                        },
                        error: function (result) {
                            $('#modal-ventana').modal('hide');
                            sut.error.show('mensajes', result.responseText);
                        }
                    });
                },
                generar: () => {

                    debugger;

                    for (var k = 0; k < sut.editProcedimiento.BaseLegal.data.length; k++) {
                        var tabla = $('#tblBaseLegal_' + k + ' tbody');
                        $('#tblBaseLegal_' + k + ' tbody tr').remove();
                        if (sut.editProcedimiento.BaseLegal.data[k].length > 0) {
                            var rows = '';
                            $.each(sut.editProcedimiento.BaseLegal.data[k], function (i, r) {
                                rows += sut.string.format('<tr data-index="{0}" >', i);
                                rows += '<td>';
                                rows += sut.string.format('<span>{0}</span>', i + 1);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].BaseLegalId" value="{2}" />', k, i, r.BaseLegalId);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].BaseLegalNormaId" value="{2}" />', k, i, r.BaseLegalNormaId);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].TipoBaseLegal" value="{2}" />', k, i, r.TipoBaseLegal);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].NormaId" value="{2}" />', k, i, r.NormaId);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].Descripcion" value="{2}" />', k, i, r.Descripcion);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].TipoNormaId" value="{2}" />', k, i, r.TipoNormaId);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].Numero" value="{2}" />', k, i, r.Numero);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].FechaPublicacion" value="{2}" />', k, i, r.FechaPublicacion);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].Articulo" value="{2}" />', k, i, r.Articulo);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].ArchivoAdjuntoId" value="{2}" />', k, i, r.ArchivoAdjuntoId);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].Url" value="{2}" />', k, i, r.Url);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].EstadoACR" value="{2}" />', k,i, r.EstadoACR);
                                rows += sut.string.format('<input type="hidden" name="Requisito[{0}].BaseLegal.BaseLegalNorma[{1}].DescripcionACR" value="{2}" />',k, i, r.DescripcionACR);


                                rows += '</td>';

                                if (r.EstadoACR==2){
                                    rows += sut.string.format('<td colspan="5">{0}</td>', r.DescripcionACR);
                                    $('#idagregarbaselegal_'+ k).hide();
                                }else{
                                    rows += sut.string.format('<td>{0}</td>', r.Articulo);
                                    rows += sut.string.format('<td>{0}</td>', r.Descripcion);
                                    rows += sut.string.format('<td>{0}</td>', r.NormaTipo);
                                    rows += sut.string.format('<td>{0}</td>', r.Numero);
                                    rows += sut.string.format('<td>{0}</td>', r.FechaPublicacion);
                                    $('#idagregarbaselegal_'+ k).show();
                                }


                                //rows += sut.string.format('<td>{0}</td>', r.NormaTipo);
                                //rows += sut.string.format('<td>{0}</td>', r.Numero);
                                //rows += sut.string.format('<td>{0}</td>', r.Descripcion);
                                //rows += sut.string.format('<td>{0}</td>', r.FechaPublicacion);
                                //rows += sut.string.format('<td>{0}</td>', r.Articulo);
                                //rows += '<td class="text-center">';
                                //if (r.TipoBaseLegal == 3) {
                                //    rows += sut.string.format('<a href="{0}" class="btn btn-primary btn-xs" target="_blank" ><i class="fa fa-link"></i></a>', r.Url);
                                //} else {
                                //    rows += sut.string.format('<a href="{0}" class="btn btn-primary btn-xs" target="_blank" ><i class="fa fa-file"></i></a>', '');
                                //}
                                //rows += '</td>';
                                rows += '<td><div class="btn-group">';
                                if ("@user.rolmenu[0].Editar" == "True"){
                                    rows += sut.string.format('<a class="btn btn-success btn-xs" href="javascript:sut.editProcedimiento.BaseLegal.edit({0}, {1}, {1})" ><i class="fa fa-pencil" ></i></a>', k, i, r.RequisitoId);
                                }
                                rows += '</div></td>';
                                rows += '<td><div class="btn-group">';
                                if ("@user.rolmenu[0].Eliminar" == "True"){
                                    rows += sut.string.format('<a class="btn btn-danger btn-xs" href="javascript:sut.editProcedimiento.BaseLegal.delete({0}, {1}, {1})" ><i class="fa fa-close" ></i></a>', k, i, r.RequisitoId);
                                }
                                rows += '</div></td>';
                                rows += '</tr>';
                            });
                            tabla.append(rows);
                        }
                    }
                },
                add: (k) => {

                    return function (r) {
                        $('#modal-ventana').modal('hide');
                        debugger;
                        if (r.Nuevo == 1) {
                            sut.editProcedimiento.BaseLegal.data[k].push(r);
                            // codigo de registro
                            var numdat = sut.editProcedimiento.BaseLegal.data.length;

                            //eliminar informacion sustento
                            var valdat = sut.editProcedimiento.BaseLegal.datavalidar.length -1;
                            if (valdat >= k) {
                                sut.editProcedimiento.BaseLegal.datavalidar[k].push(r);
                            }


                        } else {
                            var arr = [];
                            $.each(sut.editProcedimiento.BaseLegal.data[k], function (i, d) {
                                if (i != r.Index) arr.push(d);
                                else arr.push(r);
                            });
                            sut.editProcedimiento.BaseLegal.data[k] = arr;
                            // codigo de registro

                            //eliminar informacion sustento
                            var valdat = sut.editProcedimiento.BaseLegal.datavalidar.length - 1;
                            if (valdat >= k) {
                                sut.editProcedimiento.BaseLegal.datavalidar[k] = arr;
                            }

                        }
                        sut.editProcedimiento.BaseLegal.generar();
                    }
                },
                delete: (k, index) => {
                    //sut.msg.confirm('!Se eliminará el dato seleccionado!', function () {
                        var arr = [];
                        var arr2 = [];
                        $.each(sut.editProcedimiento.BaseLegal.data[k], function (i, d) {
                            if(d.EstadoACR==2){
                                $('#idagregarbaselegal_'+k).show();
                            }
                            if (i != index) arr.push(d);
                        });
                        sut.editProcedimiento.BaseLegal.data[k] = arr;

                        $.each(sut.editProcedimiento.BaseLegal.datavalidar[k], function (i, d) {
                            if(d.EstadoACR==2){
                                $('#idagregarbaselegal_'+k).show();
                            }

                            if (i != index) arr2.push(d);
                        });
                        //eliminar informacion sustento
                        var valdat = sut.editProcedimiento.BaseLegal.datavalidar.length - 1;
                        if (valdat >= k) {
                            sut.editProcedimiento.BaseLegal.datavalidar[k] = arr2;
                        }


                        sut.editProcedimiento.BaseLegal.generar();
                    //});
                }
            },
            guardar: function () {
                debugger;
                var valid = true;

                $.each(sut.editProcedimiento.BaseLegal.datavalidar, function (i, r) {
                    //FVN Se cambia a true para quitar validacion 17-01-2019

                    if (r.length == 0) valid = false;
                });

                //if (!valid) sut.error.clientErrorShow('mensajes', 'Debe agregar al menos una Base Legal para cada requisito');

                var num = $('input[name="cla"]').val();
                var SustTecCalificacion = $('#SustTecCalificacion').val();


                debugger;
                if (num == 'Evaluación Previa con Silencio Negativo') {
                    if(SustTecCalificacion == ""){
                        showNotification('top', 'right', 'Ingresar Sustento de la Calificación', 2);
                        $('#SustTecCalificacion').focus;
                        return;
                    }
                }

                if (!valid) showNotification('top', 'right', 'Debe agregar al menos una Base Legal para cada requisito', 2);


                if ($('#form-editar').valid() && valid) {
                    var model = $('#form-editar').serialize();
                    $.ajax({
                        type: 'POST',
                        //url: '/Simplificacion/Procedimiento/SustentoTecnico',
                        url: '@Url.Content("~/Simplificacion/Procedimiento/SustentoTecnico")',
                        data: model,
                        dataType: 'json',
                        beforeSend: function () {
                            $("#mensajes").hide();
                        },
                        complete: function () {

                        },
                        success: function (result) {
                            debugger;
                            if(result.valid==false){
                                showNotification('top', 'right', 'Debe ingresar el sustento de todos lo plazos de atención.', 2);
                            }else
                            {


                            sut.msg.success(result.mensaje, function () {
                                @*window.location = '/Simplificacion/Procedimiento/SustentoTecnico/@Model.ProcedimientoId';*@
                                window.location = '@Url.Content("~/Simplificacion/Procedimiento/SustentoTecnico/")@Model.ProcedimientoId';
                            });

                            //showNotification('top', 'right', 'El Registro de Guardo Satisfactoriamente', 1);
                            //debugger;
                            deferred.resolve('Ok'); // jleon 05022019
                            if (!is_salir)
                                setTimeout("reFresh()", 1000);


                            }

                        },
                        error: function (result) {
                            sut.error.show('mensajes', result.responseText);
                        }
                    });
                }
            },

            guardarEstandar: function () {
                var valid = true;
                debugger;
                if ($('#form-editar').valid() && valid) {
                    var model = $('#form-editar').serialize();
                    $.ajax({
                        type: 'POST',
                        //url: '/Simplificacion/Procedimiento/SustentoTecnico',
                        url: '@Url.Content("~/Simplificacion/Procedimiento/SustentoTecnico")',
                        data: model,
                        dataType: 'json',
                        beforeSend: function () {
                            $("#mensajes").hide();
                        },
                        complete: function () {

                        },
                        success: function (result) {
                            sut.msg.success(result.mensaje, function () {
                                @*window.location = '/Simplificacion/Procedimiento/SustentoTecnico/@Model.ProcedimientoId';*@
                                window.location = '@Url.Content("~/Simplificacion/Procedimiento/SustentoTecnico/")@Model.ProcedimientoId';
                            });

                            //showNotification('top', 'right', 'El Registro de Guardo Satisfactoriamente', 1);
                            //debugger;
                            deferred.resolve('Ok'); // jleon 05022019
                            if (!is_salir)
                                setTimeout("reFresh()", 1000);
                        },
                        error: function (result) {
                            sut.error.show('mensajes', result.responseText);
                        }
                    });
                }
            },
            terminar: function () {

                debugger;
                var valid = true;

                $.each(sut.editProcedimiento.BaseLegal.datavalidar, function (i, r) {
                    //FVN Se cambia a true para quitar validacion 17-01-2019

                    if (r.length == 0) valid = false;
                });

                //if (!valid) sut.error.clientErrorShow('mensajes', 'Debe agregar al menos una Base Legal para cada requisito');

                var num = $('input[name="cla"]').val();
                var SustTecCalificacion = $('#SustTecCalificacion').val();


                debugger;
                if (num == 'Evaluación Previa con Silencio Negativo') {
                    if (SustTecCalificacion == "") {
                        showNotification('top', 'right', 'Ingresar Sustento de la Calificación', 2);
                        $('#SustTecCalificacion').focus;
                        return;
                    }
                }

                if (!valid) showNotification('top', 'right', 'Debe agregar al menos una Base Legal para cada requisito', 2);

                if (!valid) 
                {
                    return;
                }

                sut.msg.confirm('Si finaliza el registro no podrá modificarlo nuevamente.', () => {
                    if ($('#form-editar').valid()) {
                        var model = $('#form-editar').serialize();
                        $.ajax({
                            type: 'POST',
                            //url: '/Simplificacion/Procedimiento/SustentoTecnico',
                            url: '@Url.Content("~/Simplificacion/Procedimiento/SustentoTecnico")',
                            data: model,
                            dataType: 'json',
                            beforeSend: function () {
                                $("#mensajes").hide();
                            },
                            complete: function () {

                            },
                            success: function (result) {
                                $.ajax({
                                    type: 'POST',
                                    //url: '/Simplificacion/Procedimiento/TerminarSustento',
                                    url: '@Url.Content("~/Simplificacion/Procedimiento/TerminarSustento")',
                                    data: {tipo: 2, ProcedimientoId: @Model.ProcedimientoId , estadoExpediente: '@exp.EstadoExpediente', ExpedienteId: @exp.ExpedienteId},
                                    dataType: 'json',
                                    beforeSend: function () {
                                        $("#mensajes").hide();
                                    },
                                    complete: function () {

                                    },
                                    success: function (result) {
                                        if(result.valid) {
                                            sut.msg.success(result.mensaje, function () {
                                                @*window.location = '/Simplificacion/Procedimiento/SustentoTecnico/@Model.ProcedimientoId';*@
                                                window.location = '@Url.Content("~/Simplificacion/Procedimiento/SustentoTecnico/")@Model.ProcedimientoId';
                                            });

                                            //showNotification('top', 'right', 'El Registro se Termino Satisfactoriamente', 1);
                                            //setTimeout("reFresh()", 800);

                                        } else {

                                            sut.error.clientErrorShow('mensajes', result.mensaje);
                                        }
                                    },
                                    error: function (result) {
                                        debugger;
                                        //alert('verde');
                                        sut.error.show('mensajes', result.responseText);
                                        //showNotification('top', 'right', result.mensaje + 'Debe terminar el registro de Sustento Tecnico.', 2);
                                    }
                                });
                            },
                            error: function (result) {
                                sut.error.show('mensajes', result.responseText);
                            }
                        });
                    }
                });
            },

            textoobservacionTecnicoRequisitos: function (Descripcion, Descripcion2, estado, nomcampo, num) {
                debugger;



                var Des = Descripcion.split(";");
                var tabla = $('#divTecnicoRequisitos0_' + num + ' tbody');
                debugger;
                //var Descripcion = $('#DesTecnicoRequisitos' + num).val() + ";" + $('#chekTecnicoRequisitos' + num).val() + ";" + $('#PreTecnicoRequisitos' + num).val() + ";" + $('#CostoTecnicoRequisitos' + num).val();
                var NombreCampo = 'TecnicoRequisitos';
                var rows = '';

                //rows += sut.string.format('<tr data-index="{0}" id="trdivTecnicoRequisitos0' + num + '"  >', num);

                //rows += sut.string.format('<td style="width:20px;"> </td>');

                //rows += sut.string.format('<td><input style="border-color:green;background:#00a65a36;" type="text" id="SustentoD' + num + '" value="{0}" class="form-control" readOnly /></td>', Des[1]);

                //rows += sut.string.format('</tr>');




                rows += '<tr id="trdivTecnicoRequisitos0_' + num + '">'
                rows += sut.string.format('<td style="width:20px;">Observado </td>');
                //rows += sut.string.format('<td colspan="2" ><textarea name="TecnicoRequisitos2' + num + '" id="TecnicoRequisitos2' + num + '" class="form-control" style="border-color:red;background:#ff00002e;" readOnly>{0}</textarea></td>', Descripcion2);
                rows += sut.string.format('<td colspan="2" ><label class="form-control" name="TecnicoRequisitos2' + num + '" id="TecnicoRequisitos2' + num + '" style="border-color:red;background:#ff00002e;font-weight: 600;height: 100%;" >{0}</label></td>', Descripcion2);
                rows += '</tr>';;

                tabla.append(rows);


                $('#aAsignarGuardarObservarExp' + NombreCampo +'_'+ num + '').css({ "display": "" });
                $('#aAsignarCancelarObservarExp' + NombreCampo + '_' + num + '').css({ "display": "" });

                //$('#aValidarObservarExp' + NombreCampo +'_'+ num + '').css("display", "none");
                $('#aCancelarGeneralExp' + NombreCampo +'_'+ num + '').css("display", "none");
                $('#aObservarEditarExp' + NombreCampo +'_'+ num + '').css({ "display": "none" });
                $('#aMasivoObservarExp' + NombreCampo +'_'+ num + '').css({ "display": "" });




                //if (estado == 'Presentado') {
                //    $('#' + nomcampo + '').hide();
                //    //document.getElementById('#'+dato+'').style.visibility = "hidden";
                //    //visible
                //    $('#' + nomcampo + 'label').hide();

                //} else {
                //    $('#' + nomcampo + '').show();
                //    //document.getElementById('#'+dato+'').style.visibility = "hidden";
                //    //visible
                //    $('#' + nomcampo + 'label').show();
                //}


            },
            textosustento: function (Descripcion2, estado, nomcampo, num) {


                var tabla = $('#divTecnicoRequisitos0_' + num + ' tbody');
                debugger;
                //var Descripcion = $('#DesModalidad' + num).val() + ";" + $('#chekModalidad' + num).val() + ";" + $('#PreModalidad' + num).val() + ";" + $('#CostoModalidad' + num).val();
                var NombreCampo = 'Requisitos';
                var rows = '';


                rows += '<tr id="trdivsustentarRequisitos0_' + num + '">'
                rows += sut.string.format('<td style="width:20px;">Refutar Observación: </td>');
                rows += sut.string.format('<td colspan="3" ><textarea name="Requisitos2' + num + '" id="Requisitos2' + num + '" class="form-control" style="border-color:#f39c12;background:#f39c1259;">{0}</textarea></td>', Descripcion2);

                rows += '</tr>';;

                tabla.append(rows);


                $('#aSustentarObservarExp'+NombreCampo+num+'').css({ "display": "none" });
                $('#aGuardarSustentarExp'+NombreCampo+num+'').css({ "display": "" });
                $('#aCancelarSustentarExp'+NombreCampo+num+'').css({ "display": "" });
            },
            textosustentounidad: function (Descripcion1, nombdiv, nombdivdetalle, titulo, campo, numcol) {

                debugger;
                var rows = '';
                rows += '<div id="' + nombdivdetalle + '">';
                rows += '<label class="col-sm-2 col-xs-12 control-label" for="Objetivo">Refutar Observación:</label>';
                rows += '<div class="col-sm-' + numcol + ' col-xs-12">';
                rows += sut.string.format('<td><textarea name="' + campo + '"  id="' + campo + '" class="form-control" style="border-color:#f39c12;background:#f39c1259;" >{0}</textarea></td>', Descripcion1);
                rows += '</div>';
                rows += '</div>';
                $('#' + nombdiv + '').append(rows);
            },
            sustentarObservarExpRequisitos: function (num) {


                var tabla = $('#divTecnicoRequisitos0_' + num + ' tbody');
                debugger;
                //var Descripcion = $('#DesModalidad' + num).val() + ";" + $('#chekModalidad' + num).val() + ";" + $('#PreModalidad' + num).val() + ";" + $('#CostoModalidad' + num).val();
                var NombreCampo = 'Requisitos';
                var rows = '';

                rows += '<tr id="trdivsustentarRequisitos0_' + num + '">'
                rows += sut.string.format('<td style="width:20px;"> Refutar Observación: </td>');
                rows += sut.string.format('<td colspan="3" ><textarea name="Requisitos2' + num + '" id="Requisitos2' + num + '" class="form-control" style="border-color:#f39c12;background:#f39c1259;">{0}</textarea></td>', '');

                rows += '</tr>';;

                tabla.append(rows);




                $('#aSustentarObservarExp'+NombreCampo+'_'+num+'').css({ "display": "none" });
                $('#aGuardarSustentarExp'+NombreCampo+'_'+num+'').css({ "display": "" });
                $('#aCancelarSustentarExp'+NombreCampo+'_'+num+'').css({ "display": "" });

            },
            guardarSustentarExpRequisitos: function (idExpediente,procedimientoId,numero,RequisitoId) {
                if ($('#Requisitos2'+numero+'').val().trim() == "") {

                    showNotification('top', 'right', 'No puedes Guardar una justificación en blanco', 2);
                    return;
                }

                var model = {
                    'filtro.ExpedienteId': idExpediente,
                    'filtro.ProcedimientoId': procedimientoId,
                    'filtro.Descripcion': $('#Requisitos2'+numero+'').val(),
                    'filtro.CodValidacion': '3',
                    'filtro.TipoEstado': '3',
                    'filtro.NombreCampo': 'NombredelosTecnicoRequisitos' + numero,
                    'filtro.Pantalla': 'Sustento Tecnico',
                    'filtro.Estado': '1',
                    'filtro.RequisitoId': RequisitoId,
                };
                $.ajax({
                    type: "POST",
                    //url: '/Simplificacion/Expediente/AgregarObservacion',
                    url: '@Url.Content("~/Simplificacion/Expediente/AgregarObservacion")',
                    data: model,
                    cache: false,
                    beforeSend: function () {
                        //sut.wait.modal('ventana-container');
                        //$('#modal-ventana').modal('show');
                    },
                    success: function (data) {

                        $('#modal-ventana').modal('hide');

                        $('#mensajeTecnicoRequisitos_'+numero+'').show();
                        document.querySelector('#mensajeTecnicoRequisitos_'+numero+'').innerText = 'Se refuto con éxito';

                    },
                    error: function (result) {
                        $('#modal-ventana').modal('hide');
                        sut.error.show('mensajes', result.responseText);
                    }
                });

                comentario = "";
            },
            comentario: "",
            CancelarSustentarExpRequisitos: function (idExpediente,procedimientoId,numero,RequisitoId) {
                var NombreCampo = 'Requisitos';
                var model = {
                    'filtro.ExpedienteId': idExpediente,
                    'filtro.ProcedimientoId': procedimientoId,
                    'filtro.Descripcion': $('#Requisitos2'+numero+'').val(),
                    'filtro.CodValidacion': '3',
                    'filtro.TipoEstado': '3',
                    'filtro.NombreCampo': 'NombredelosTecnicoRequisitos' + numero,
                    'filtro.Pantalla': 'Sustento Tecnico',
                    'filtro.Estado': '1',
                    'filtro.RequisitoId': RequisitoId,
                };

                $.ajax({
                    type: "POST",
                    //url: '/Simplificacion/Expediente/CancelarDescripcion1',
                    url: '@Url.Content("~/Simplificacion/Expediente/CancelarDescripcion1")',
                    data: model,
                    cache: false,
                    beforeSend: function () {
                        //sut.wait.modal('ventana-container');
                        //$('#modal-ventana').modal('show');
                    },
                    success: function (data) {
                        debugger;
                        $('#modal-ventana').modal('hide');

                        $('#aSustentarObservarExp'+NombreCampo+'_'+numero+'').css({ "display": "" });
                        $('#aGuardarSustentarExp'+NombreCampo+'_'+numero+'').css({ "display": "none" });
                        $('#aCancelarSustentarExp'+NombreCampo+'_'+numero+'').css({ "display": "none" });

                        $('#trdivsustentarRequisitos0_'+numero+'').remove();
                        $('#mensajeTecnicoRequisitos_'+numero+'').hide();
                        document.querySelector('#mensajeTecnicoRequisitos_'+numero+'').innerText = '';


                    },
                    error: function (result) {
                        $('#modal-ventana').modal('hide');
                        sut.error.show('mensajes', result.responseText);
                    }
                });

                comentario = "";

            },
            sustentarObservarExp: function (Descripcion1, nombdiv, nombdivdetalle, NombreCampo, titulo, numcol) {

                debugger;
                var rows = '';
                rows += '<div id="' + nombdivdetalle + '">';
                rows += '<label class="col-sm-2 col-xs-12 control-label" for="Objetivo">Refutar Observación:</label>';
                rows += '<div class=col-sm-' + numcol + ' col-xs-12">';
                rows += sut.string.format('<td><textarea name="' + Descripcion1 + '"  id="' + Descripcion1 + '" class="form-control" style="border-color:#f39c12;background:#f39c1259;"></textarea></td>');
                rows += '</div>';
                rows += '</div>';
                $('#' + nombdiv + '').append(rows);

                $('#aSustentarObservarExp' + NombreCampo + '').css({ "display": "none" });
                $('#aGuardarSustentarExp' + NombreCampo + '').css({ "display": "" });
                $('#aCancelarSustentarExp' + NombreCampo + '').css({ "display": "" });

            },
            AsignarSustentarexp: {
                guardarSustentarExp: function (idExpediente, procedimientoId, Descripcion, NombreCampo, Pantalla) {

                    if ($('#' + Descripcion + '').val().trim() == "") {
                        showNotification('top', 'right', 'No puedes Guardar una justificación en blanco', 2);
                        return;
                    }
                    var model = {
                        'filtro.ExpedienteId': idExpediente,
                        'filtro.ProcedimientoId': procedimientoId,
                        'filtro.Descripcion': $('#' + Descripcion + '').val(),
                        'filtro.CodValidacion': '3',
                        'filtro.TipoEstado': '3',
                        'filtro.NombreCampo': NombreCampo,
                        'filtro.Pantalla': Pantalla,
                        'filtro.Estado': '1',
                    };
                    $.ajax({
                        type: "POST",
                        //url: '/Simplificacion/Expediente/AgregarObservacion',
                        url: '@Url.Content("~/Simplificacion/Expediente/AgregarObservacion")',
                        data: model,
                        cache: false,
                        beforeSend: function () {
                            //sut.wait.modal('ventana-container');
                            //$('#modal-ventana').modal('show');
                        },
                        success: function (data) {

                            $('#modal-ventana').modal('hide');

                            $('#mensaje' + NombreCampo + '').show();
                            document.querySelector('#mensaje' + NombreCampo + '').innerText = 'Se refuto con éxito';

                        },
                        error: function (result) {
                            $('#modal-ventana').modal('hide');
                            sut.error.show('mensajes', result.responseText);
                        }
                    });

                    comentario = "";
                },
                comentario: "",
                CancelarSustentarExp: function (idExpediente, procedimientoId, Descripcion, NombreCampo, Pantalla, nombdivdetalle) {

                    var model = {
                        'filtro.ExpedienteId': idExpediente,
                        'filtro.ProcedimientoId': procedimientoId,
                        'filtro.Descripcion': $('#' + Descripcion + '').val(),
                        'filtro.CodValidacion': '3',
                        'filtro.TipoEstado': '3',
                        'filtro.NombreCampo': NombreCampo,
                        'filtro.Pantalla': Pantalla,
                        'filtro.Estado': '1',
                    };

                    $.ajax({
                        type: "POST",
                        //url: '/Simplificacion/Expediente/CancelarDescripcion1',
                        url: '@Url.Content("~/Simplificacion/Expediente/CancelarDescripcion1")',
                        data: model,
                        cache: false,
                        beforeSend: function () {
                            //sut.wait.modal('ventana-container');
                            //$('#modal-ventana').modal('show');
                        },
                        success: function (data) {
                            debugger;
                            $('#modal-ventana').modal('hide');

                            $('#aSustentarObservarExp' + NombreCampo + '').css({ "display": "" });
                            $('#aGuardarSustentarExp' + NombreCampo + '').css({ "display": "none" });
                            $('#aCancelarSustentarExp' + NombreCampo + '').css({ "display": "none" });

                            $('#' + nombdivdetalle + '').remove();
                            $('#mensaje' + NombreCampo + '').hide();
                            document.querySelector('#mensaje' + NombreCampo + '').innerText = '';


                        },
                        error: function (result) {
                            $('#modal-ventana').modal('hide');
                            sut.error.show('mensajes', result.responseText);
                        }
                    });

                    comentario = "";

                }
            },
            textoobservacion: function (Descripcion1, Descripcion2, nombdiv, nombdivdetalle, titulo, campo1, campo2, numcol, estado, nomcampo) {
                debugger;
                var rows = '';
                rows += '<div id="' + nombdivdetalle + '">';
                rows += '<label class="col-sm-2 col-xs-12 control-label" for="Objetivo">Observado </label>';
                rows += '<div class="col-sm-' + numcol + ' col-xs-12">';
                //rows += sut.string.format('<td><textarea name="' + campo2 + '" id="' + campo2 + '" class="form-control" style="border-color:red;background:#ff00002e;" readonly>{0}</textarea></td>', Descripcion2);
                rows += sut.string.format('<td><label class="form-control" name="' + campo2 + '" id="' + campo2 + '"  style="border-color:red;background:#ff00002e;font-weight: 600;height: 100%;" >{0}</label>', Descripcion2);
                rows += '</div>';
                rows += '</div>';
                $('#' + nombdiv + '').append(rows);

                if (estado == 'Presentado') {
                    $('#' + nomcampo + '').hide();
                    //document.getElementById('#'+dato+'').style.visibility = "hidden";
                    //visible
                    $('#' + nomcampo + 'label').hide();

                } else {
                    $('#' + nomcampo + '').show();
                    //document.getElementById('#'+dato+'').style.visibility = "hidden";
                    //visible
                    $('#' + nomcampo + 'label').show();
                }


            },

        };

        $(function () {
            sut.editProcedimiento.BaseLegal.init();
            var num = $('input[name="cla"]').val();
            debugger;
            if (num != 'Aprobación Automática') {


                if (@user.Rol!= 1) {
                    $('#form-editar').validate({
                        errorPlacement: function (error, element) {
                            if (element.parent('div.input-group').length > 0) {
                                error.insertAfter(element.parent('div.input-group'));
                            } else {
                                error.insertAfter(element);
                            }
                        },
                        rules: {

                            SustTecCalificacion: 'required' /// validar por arministrado


                        },
                        messages: {

                        }
                    });
                }
            }
             @{

                 var j = (int)Model.TipoPlazo;
             }

            $("#TipoPlazo").val(@j.ToString());




            /*desarrollo de la ayuda*/
            /*minimizar un modal*/

            sut.control.Actualizartexto();

            var $content, $modal, $apnData, $modalCon;

            $content = $(".min");


            //To fire modal
            $(".mdlFire").click(function (e) {
                debugger;
                e.preventDefault();

                var $id = $(this).attr("data-target");

                $($id).modal({ backdrop: false, keyboard: false });

            });

            debugger;

            if(@user.Ayuda==1){
                $('#edit-fase-preparatoria').addClass('active');
                $('a[href="#edit-fase-preparatoria"]').parent().addClass('active');


                $('#tituloocultar').hide();


                $('#modalAyudaAvatar1').modal({backdrop: 'static', keyboard: false})
                $modal = "#modalAyudaAvatar1"
                $($modal).toggleClass("min");
                $modal = "#modalAyudaAvatar1";
                $(".modal-backdrop").addClass("display-none");
                $(".minmaxConayuda").append($apnData);
                $(".modal").css({
                    backgroundColor: "transparent"
                });

            }



            /*fin*/

            $(".modalMinimize").on("click", function(){
                debugger;
                $modalCon = $(this).closest(".mymodal").attr("id");
                $apnData = $(this).closest(".mymodal");
                $modal = "#" + $modalCon;
                $(".modal-backdrop").addClass("display-none");

                $($modal).toggleClass("min2");
                if ( $($modal).hasClass("min2") ){
                    $('#tituloocultar').show();
                    $(".minmaxCon").append($apnData);
                    //$(this).find("i").toggleClass( 'fa-minus fa-2x').toggleClass( 'fa-clone fa-2x');
                    $(".modal").css({
                        backgroundColor: "transparent"
                    });
                }
                else {
                    $('#tituloocultar').hide();
                    $(".minmaxConayuda").append($apnData);
                    //$(this).find("i").toggleClass( 'fa-clone fa-2x').toggleClass( 'fa-minus fa-2x');
                    $(".modal").css({
                        backgroundColor: "transparent"
                    });
                };
            });







        });

        function reFresh() {
            @*window.location = '/Simplificacion/Procedimiento/SustentoTecnico/@Model.ProcedimientoId';*@
            window.location = '@Url.Content("~/Simplificacion/Procedimiento/SustentoTecnico/")@Model.ProcedimientoId';
        }



        function observarbotonesModalidad(NombreCampo, num) {
            $('#aAsignarGuardarObservarExp' + NombreCampo +'_'+ num + '').css({ "display": "" });
            $('#aAsignarCancelarObservarExp' + NombreCampo + '_' + num + '').css({ "display": "" });

            //$('#aValidarObservarExp' + NombreCampo + '_' + num + '').css("display", "none");
            $('#aCancelarGeneralExp' + NombreCampo + '_' + num + '').css("display", "none");
            $('#aObservarEditarExp' + NombreCampo + '_' + num + '').css({ "display": "none" });
            $('#aMasivoObservarExp' + NombreCampo + '_' + num + '').css({ "display": "" });
        }
        function valiarbotonesModalidad(NombreCampo, num) {
            //$('#aValidarObservarExp' + NombreCampo + '_' + num + '').css("display", "");
            $('#aCancelarGeneralExp' + NombreCampo + '_' + num + '').css("display", "");
            $('#aObservarEditarExp' + NombreCampo + '_' + num + '').css({ "display": "none" });
            $('#aMasivoObservarExp' + NombreCampo + '_' + num + '').css({ "display": "none" });
        }
        function canceladobotonesModalidad(NombreCampo, num) {
            $('#aAsignarGuardarObservarExp' + NombreCampo + '_' + num + '').css({ "display": "none" });
            $('#aAsignarCancelarObservarExp' + NombreCampo + '_' + num + '').css({ "display": "none" });
            //$('#aValidarObservarExp' + NombreCampo + '_' + num + '').css("display", "");
            $('#aCancelarGeneralExp' + NombreCampo + '_' + num + '').css("display", "none");
            $('#aObservarEditarExp' + NombreCampo + '_' + num + '').css({ "display": "" });
            $('#aMasivoObservarExp' + NombreCampo + '_' + num + '').css({ "display": "none" });
        }
        function sustentobotones(NombreCampo, num) {


            $('#aSustentarObservarExp'+NombreCampo+'_' + num + '').css({ "display": "none" });
            $('#aGuardarSustentarExp'+NombreCampo+'_' + num + '').css({ "display": "" });
            $('#aCancelarSustentarExp'+NombreCampo+'_' + num + '').css({ "display": "" });

        }
        function sustentobotonesunidad(NombreCampo) {


            $('#aSustentarObservarExp' + NombreCampo + '').css({ "display": "none" });
            $('#aGuardarSustentarExp' + NombreCampo + '').css({ "display": "" });
            $('#aCancelarSustentarExp' + NombreCampo + '').css({ "display": "" });

        }
        function valiarbotones(NombreCampo) {
            //$('#aValidarObservarExp' + NombreCampo + '').css("display", "");
            $('#aCancelarGeneralExp' + NombreCampo + '').css("display", "");
            $('#aObservarEditarExp' + NombreCampo + '').css({ "display": "none" });
            $('#aMasivoObservarExp' + NombreCampo + '').css({ "display": "none" });
        }
        function observarbotones(NombreCampo) {
            $('#aAsignarGuardarObservarExp' + NombreCampo + '').css({ "display": "" });
            $('#aAsignarCancelarObservarExp' + NombreCampo + '').css({ "display": "" });

            //$('#aValidarObservarExp' + NombreCampo + '').css("display", "none");
            $('#aCancelarGeneralExp' + NombreCampo + '').css("display", "none");
            $('#aObservarEditarExp' + NombreCampo + '').css({ "display": "none" });
            //$('#aMasivoObservarExp' + NombreCampo + '').css({ "display": "" });
        }
        function canceladobotones(NombreCampo) {
            $('#aAsignarGuardarObservarExp' + NombreCampo + '').css({ "display": "none" });
            $('#aAsignarCancelarObservarExp' + NombreCampo + '').css({ "display": "none" });
            //$('#aValidarObservarExp' + NombreCampo + '').css("display", "");
            $('#aCancelarGeneralExp' + NombreCampo + '').css("display", "none");
            $('#aObservarEditarExp' + NombreCampo + '').css({ "display": "" });
            $('#aMasivoObservarExp' + NombreCampo + '').css({ "display": "none" });
        }

        function canceladobotonessustento(NombreCampo) {
            $('#aSustentarObservarExp' + NombreCampo + '').css({ "display": "none" });
        }
    </script>
}
