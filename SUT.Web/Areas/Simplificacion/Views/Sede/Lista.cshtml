@model List<Sut.Entities.Sede>
@{  
    ViewBag.Title = "Sedes";
    ViewBag.Descripcion = "Registro de sedes de atención de la entidad";
    var activar = "active";
    Sut.Security.UsuarioInfo user = ViewBag.Usuario as Sut.Security.UsuarioInfo; }

<div class="callout callout-warning" style="display: inherit;height: inherit; padding: inherit;">
    En esta sección debe registrar el listado completo de sedes o centros en las cuales se atienden los procedimientos administrativos y  servicios prestados en exclusividad.
</div>
<div id="mensajes"></div>

<div class="nav-tabs-custom">

    <ul class="nav nav-tabs">
        @if (@ViewBag.TipoSede == 1)
        {
            <li class="@activar">
                <a href="#edit-info-basica" data-toggle="tab" onclick="javascript:sut.Sede.visualizar(0)" aria-expanded="false" style="border-radius: 10px;"><i class="fa fa-file"></i> Sedes</a>
            </li> }
        else
        {
            <li>
                <a href="#edit-info-basica" data-toggle="tab" onclick="javascript:sut.Sede.visualizar(0)" aria-expanded="false" style="border-radius: 10px;"><i class="fa fa-file"></i> Sedes</a>
            </li>
            }

        @if (@ViewBag.TipoSede == 2)
        {
            <li class="@activar">
                <a href="#edit-info-basica1" data-toggle="tab" onclick="javascript:sut.Sede.visualizar(1)" aria-expanded="false" style="border-radius: 10px;"><i class="fa fa-file"></i> Agrupados</a>
            </li> }
        else
        {
            <li>
                <a href="#edit-info-basica1" data-toggle="tab" onclick="javascript:sut.Sede.visualizar(1)" aria-expanded="false" style="border-radius: 10px;"><i class="fa fa-file"></i> Agrupados</a>
            </li>
        }

    </ul>
</div>

<div class="row">

    @if (ViewBag.TipoSede == 1)
    {
<div class="col-xs-12">
    <div id="boxLista" class="box box-danger">
        <div class="box-body">
            @if (@user.Ayuda == 1)
            {
                 <a class="btn btn-success pulsesut-button" href="javascript:sut.Sede.editar(0)"><i class="fa fa-plus"></i> Nuevo</a>
                 <a class="btn btn-success pulsesut-button" href="javascript:sut.Sede.editarlogo('@ViewBag.EntidadId')"><i class="fa fa-paint-brush"></i> Logo Entidad</a> 
            }
            else
            {
                    if (@user.rolmenu[0].Nuevo == true)
                    {
                        <a class="btn btn-success" href="javascript:sut.Sede.editar(0)"><i class="fa fa-plus"></i> Nuevo</a>
                        <a class="btn btn-success pulsesut-button" href="javascript:sut.Sede.editarlogo('@ViewBag.EntidadId')"><i class="fa fa-paint-brush"></i> Logo Entidad</a>
                    }
            }

            <br />
            <div class="table-responsive">
                <table id="tblLista" class="table table-bordered table-striped table-hover"
                       data-pagesize="20"
                       data-page="1"
                       data-totalrows="0"
                       data-function="sut.Sede.listar"
                       data-paginator="paginator">
                    <thead>
                        <tr>
                            <th class="colAction">Nro.</th>
                            <th>Tipo</th>
                            <th>Nombre</th>
                            <th>Distrito-Provincia-Departamento</th>
                            <th>Dirección</th>
                            <th>Recepción Documentaria</th>
                            <th>Horario de atención</th>
                            <th>Grupo</th>
                            <th class="colAction" style="width:50px"></th>
                            <th class="colAction" style="width:50px"></th>
                        </tr>
                        <tr>
                            <th><button class="btn btn-default btn-xs" title="Borrar Filtros" data-toggle="tooltip" data-placement="right"><i class="fa fa-filter"></i></button></th>
                            <td></td>
                            <th><input id="txtFilterNombre" type="text" class="form-control input-sm" /></th>
                            <td></td>
                            <th><input id="txtFilterDireccion" type="text" class="form-control input-sm" /></th>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                        <tr><td colspan="12"><div id="paginator"></div></td></tr>
                    </tfoot>
                </table>
            </div>

        </div>
    </div>
</div>
}
@if (ViewBag.TipoSede == 2)
{
    <div class="table-responsive">

        <div class="panel-group" id="accordion">
        </div>
    </div>
}

</div>

<div class="modal fade" id="modal-ventana" data-backdrop="static" data-keyboard="false">
    <div id="ventana-container">

    </div>
</div>




<div class="modal fade mymodal" id="modalSeguimiento">
    <div class="modal-dialog modal-lg" style="width:90%">
        <div class="modal-content" style="border-radius: 40px 40px 0 0;">

            <div class="modal-body" id="contenido" style="padding:0px">
                <div class="bar-title">
                    @*<a class="close"  data-dismiss="modal" style="padding: 80px; top: -80px; background: transparent"> <i class='fa fa-times fa-2x'></i> </a>*@
                    @*<a class="close modalMinimize" style="padding:100px; right: 20px;  top: -100px; background: transparent"> <i class='fa fa-minus fa-2x'></i> </a>*@
                    @*<button class="close modalMinimize"> <i class='fa fa-minus'></i> </button>*@
                    <span>
                        <h5 id="ihtitulo1" style="font-size: xx-large;text-align: center;font-family: initial;"> Hola @user.Nombres, bienvenido al Sistema Único de Trámites</h5>
                        <h5 id="ihtitulo2" style="font-size: x-large;text-align: center;font-family: initial;"> </h5>
                    </span>
                </div>
                <div class="col-sm-12 col-xs-12">

                    <div class="col-sm-12 col-xs-12" id="idtitulo3" style="text-align:center">
                        <div id="colorNavContenido">

                        </div>


                        <div class="col-sm-12 col-xs-12">
                            <img src="~/dist/img/hola.png" style="width: 160px;" />
                            <div class="caja">
                                <h5 style="font-size: 20px;text-align: center;font-family: initial;">
                                    Muy bien! Felicidades a hora has Clic en el boton <label id="nombremenu"></label>  para comenzar!
                                </h5>
                            </div>
                        </div>
                        <div class="col-sm-12 col-xs-12">
                            <div class="col-sm-6 col-xs-12" style="text-align: left;">
                                <a class="btn btn-success" href="javascript:sut.Sede.Avanzar(0)" style="font-size: xx-large;"><i class="fa fa-arrow-left"></i> Retroceder</a>
                            </div>
                        </div>



                    </div>

                </div>



            </div>
            <div class="modal-footer">
                @*<button type="button" class="btn btn-primary">Save changes</button>*@
            </div>
        </div>
    </div>
</div>






<div class="minmaxConayuda">
    <div class="modal fade mymodal" id="modalAyudaAvatar1">
        <div class="modal-dialog  ">
            <div class="modal-content">
                <div class="modal-body" id="contenido" style="padding:0px">
                    <div class="bar-title" id="tituloocultar">
                        <a class="close modalMinimize" style="padding:110px; right: 20px;  top: -100px; background: transparent"> <i class='fa fa-clone '></i> </a>
                        <span>
                            <h3 id="ihtitulo1" style="font-size: x-large;text-align: center;font-family: initial;"> Hola @user.Nombres </h3>
                        </span>
                    </div>

                    <div>
                        <div id="idtitulo1" style="text-align:left">
                            <div class="col-sm-3 col-xs-2">
                                <a class="modalMinimize" title="Minimizar" style="color:black"> <i class='fa fa-minus fa-2x'></i> </a>
                                <img src="~/dist/img/hola.png" class="img-rounded" alt="Cinque Terre" />
                            </div>
                            <div class="caja col-sm-5" id="mensaje1" style="display: none; width:409px;height:100%;top:137px">
                                <sp style="text-align: left;font-family: initial;"> Clic en</sp>
                                <a class="btn btn-success btn-xs" href="#"><i class="fa fa-plus"></i> Nuevo</a>
                                <l style="text-align: left;font-family: initial;">para agregar las Sedes ¡Suerte!</l>
                            </div>
                            <div class="caja col-sm-5" id="mensaje2" style="display: none; width:440px;height:100%;top:103px">
                                <j2 style="text-align: left;font-family: initial;">¡Felicidades! ¿Registraste todos las sedes ? Si es así, avancemos al siguiente paso. Clic </j2>
                                <a id="clic" style="display: none;" class="btn btn-warning" href="javascript:sut.Sede.GuardarMenu(6)"><i class="fa fa-arrow-right"></i>Aqui</a>
                                <l1 style="text-align: left;font-family: initial;"> Para continuar. ¡Tú puedes! </l1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>
<div class="minmaxCon"></div>





@section Style {
    <style type="text/css">
        table#tblLista thead tr th {
            text-align: center;
        }

        table#tblLista tbody tr td[colspan="8"] {
            font-weight: bold;
            text-align: center;
        }

        #tblLista .colNro {
            width: 40px;
            text-align: center;
        }

        #tblLista .colAction {
            width: 30px;
        }

        #tblLista tfoot .pagination {
            margin: 0px 0px;
        }
    </style>
}

@section Script {
    <script>

        sut.Sede = {
            /*JJJMSP2 INI*/
            editarlogo: (id) => {
                $.ajax({
                    type: "GET",
                    //url: '/Seguridad/Entidad/Editar',
                    url: '@Url.Content("~/Seguridad/Entidad/Editar")',
                    data: { id: id, vertodo: 0 },
                    cache: false,
                    beforeSend: () => {
                        sut.wait.modal('ventana-container');
                        $('#modal-ventana').modal('show');
                    },
                    success: (data) => {
                        $('#ventana-container').html(data);
                    },
                    error: (result) => {
                        $('#modal-ventana').modal('hide');
                        sut.error.show('mensajes', result.responseText);
                    },
                    statusCode: {
                        203: () => { window.location.reload(); }
                    }
                });
            },
            /*JJJMSP2 FIN*/
            editar: function (id) {
                $.ajax({
                    type: "GET",
                    //url: '/Simplificacion/Sede/Editar',
                    url: '@Url.Content("~/Simplificacion/Sede/Editar")',
                    data: { id: id },
                    cache: false,
                    beforeSend: function () {
                        sut.wait.modal('ventana-container');
                        $('#modal-ventana').modal('show');
                    },
                    success: function (data) {
                        $('#ventana-container').html(data);
                    },
                    error: function (result) {
                        $('#modal-ventana').modal('hide');
                        sut.error.show('mensajes', result.responseText);
                    }
                });
            },
            Agregar: function (id) {
                $.ajax({
                    type: "GET",
                    //url: '/Simplificacion/Sede/Editar',
                    url: '@Url.Content("~/Simplificacion/Sede/Agregar")',
                    data: { id: id },
                    cache: false,
                    beforeSend: function () {
                        sut.wait.modal('ventana-container');
                        $('#modal-ventana').modal('show');
                    },
                    success: function (data) {
                        $('#ventana-container').html(data);
                    },
                    error: function (result) {
                        $('#modal-ventana').modal('hide');
                        sut.error.show('mensajes', result.responseText);
                    }
                });
            },
            eliminar: function (id) {

                var model = {
                    SedeId: id
                }
                 sut.msg.confirm("Que desea eliminar la Sede", function () {
                    $.ajax({
                        //url: "/Simplificacion/UnidadOrganica/ExisteEnProcedimiento",
                        url: '@Url.Content("~/Simplificacion/Sede/ExisteEnProcedimiento")',
                        type: "POST",
                        data: model,
                        dataType: "json",
                        beforeSend: function () {
                            sut.wait.appendOverlay('#boxLista');
                        },
                        success: function (data) {
                            $('#modal-ventana').modal('hide');
                            debugger;
                            if (data.Message == '0') {

                                sut.msg.success("Se elimino la Sede", function () {
                                    sut.Sede.listar(1);
                                });
                            } else
                            {
                                var mensaje = data.Message;
                                sut.msg.alerta(mensaje, function () {
                                    sut.Sede.listar(1);
                                });
                            }

                        },
                        error: function (data) {
                            sut.error.show('mensajes', data.responseText);
                        }
                    });
                });
                @*$.ajax({
                    //url: "/Simplificacion/Sede/ExisteEnProcedimiento",
                    url: '@Url.Content("~/Simplificacion/Sede/ExisteEnProcedimiento")',
                    type: "POST",
                    data: model,
                    dataType: "json",
                    beforeSend: function () {
                        sut.wait.appendOverlay('#boxLista');
                    },
                    success: function (data) {
                        sut.wait.removeOverlay('#boxLista');
                        if (!data.Value)
                            sut.msg.confirm("Desea Eliminar ", function () {
                                $.ajax({
                                    //url: "/Simplificacion/Sede/Eliminar",
                                    url: '@Url.Content("~/Simplificacion/Sede/Eliminar")',
                                    type: "POST",
                                    data: model,
                                    dataType: "json",
                                    beforeSend: function () {
                                        sut.wait.appendOverlay('#boxLista');
                                    },
                                    success: function (data) {
                                        sut.wait.removeOverlay('#boxLista');
                                        sut.Sede.listar(1);
                                    },
                                    error: function (data) {
                                        sut.wait.removeOverlay('#boxLista');
                                        sut.error.show('mensajes', data.responseText);
                                    }
                                });
                            });
                        else
                            sut.msg.msgUsuario("La sede no se puede eliminar. Esta sede se encuentra asociado en algunos procedimientos.", 'Sede ya existe en algunos Procedimientos.');
                    },
                    error: function (data) {
                        sut.error.show('mensajes', data.responseText);
                    }
                });*@



            },
            eliminarsedegrupo: function (id) {

                var model = {
                    SedeId: id
                }
                      $.ajax({
                        //url: "/Simplificacion/Sede/Eliminar",
                        url: '@Url.Content("~/Simplificacion/Sede/EliminarGrupo")',
                        type: "POST",
                        data: model,
                        dataType: "json",
                        beforeSend: function () {
                            sut.wait.appendOverlay('#boxLista');
                        },
                        success: function (data) {
                            sut.wait.removeOverlay('#boxLista');
                            location.reload();
                        },
                        error: function (data) {
                            sut.wait.removeOverlay('#boxLista');
                            sut.error.show('mensajes', data.responseText);
                        }
                    });
            },
            listar: function (page) {
                table = $('#tblLista');
                var model = {
                    'filtro.Nombre': $('#txtFilterNombre').val(),
                    'filtro.Direccion': $('#txtFilterDireccion').val(),
                    pageIndex: page,
                    pageSize: table.data('pagesize')
                };
                $.ajax({
                    //url: "/Simplificacion/Sede/GetAllLikePagin",
                    url: '@Url.Content("~/Simplificacion/Sede/GetAllLikePagin")',
                    type: "GET",
                    data: model,
                    dataType: "json",
                    beforeSend: function () {
                        sut.wait.appendOverlay('#boxLista');
                    },
                    success: function (data) {
                        sut.wait.removeOverlay('#boxLista');
                        table.data('page', page);
                        table.data('totalrows', data.totalRows);
                        sut.Sede.generar(data.lista);
                        if (data.totalRows == 0) $('#tblLista tbody').append("<tr><td colspan='8' class='text-center text-bold'>NO SE ENCONTRARON REGISTROS.</td></td>");


                        debugger;

                        if (data.totalRows < 1) {
                            $('#mensaje2').hide();
                            $('#mensaje1').show();
                        } else {
                            $('#mensaje2').show();
                            $('#mensaje1').hide();
                            sut.control.Actualizartexto();
                        }
                    },
                    error: function (data) {
                        sut.error.show('mensajes', data.responseText);
                    }
                });
            },
            generar: function (lista) {
                var table = $('#tblLista');
                var tabla = table.children('tbody');
                tabla.children('tr').remove();
                var rows = '';
                var numero = (table.data('pagesize') * table.data('page')) - table.data('pagesize');
                $.each(lista, function (i, r) {
                    rows += sut.string.format('<tr><td class="colNro" >{0}</td>', ++numero);
                    rows += sut.string.format('<td>{0}</td>', r.TipoSede);
                    rows += sut.string.format('<td>{0}</td>', r.Nombre);
                    rows += sut.string.format('<td>{0}</td>', r.Ubigeo);
                    rows += sut.string.format('<td>{0}</td>', r.Direccion);
                    rows += sut.string.format('<td>{0}</td>', r.ListaUndOrganica);
                    rows += sut.string.format('<td>{0}</td>', r.Horario);
                    if(r.Tipogrupo==1)
                    {
                       rows += sut.string.format('<td>Si</td>');
                    }else
                    {
                       rows += sut.string.format('<td>No</td>');
                    }

                    rows += '<td>';
                    rows += '<div class="btn-group">';
                    if ("@user.rolmenu[0].Editar" == "True"){
                        rows += sut.string.format('<a class="btn btn-success btn-xs"  data-placement="left" title="Editar" href="javascript:sut.Sede.editar({0})" ><i class="fa fa-pencil"></i></a>', r.SedeId);
                    }
                    rows += '</div>';
                    rows += '</td>';
                    rows += '<td>';
                    rows += '<div class="btn-group">';
                    if ("@user.rolmenu[0].Eliminar" == "True"){
                        rows += sut.string.format('<a class="btn btn-danger btn-xs"  data-placement="left" title="Eliminar" href="javascript:sut.Sede.eliminar({0})" ><i class="fa fa-close"></i></a>', r.SedeId);
                    }
                    rows += '</div>';
                    rows += '</td>';
                    rows += '</tr>';
                });
                sut.pagination.update(table);
                tabla.append(rows);
            },
            Avanzar: (estado) => {

                if (estado == 1) {
                    $('#modalAyudaAvatar1').modal('hide');
                    $('#modalSeguimiento').modal('show');
                } else {
                    $('#modalSeguimiento').modal('hide');
                    $('#modalAyudaAvatar1').modal({ backdrop: 'static', keyboard: false })
                    $(".modal-backdrop").addClass("display-none");
                    $(".modal").css({
                        backgroundColor: "transparent"
                    });
                    //$('#modalAyudaAvatar1').modal('show');
                }
            },
            comenzar: function () {
                window.location = '@Url.Content("~/Simplificacion/Sede/ListaPersonal")';
            },

            GuardarMenu: (menuid) => {

                $.ajax({
                    type: "GET",
                    //url: '/Seguridad/Miembro/Eliminar',
                    url: '@Url.Content("~/Seguridad/Miembro/GuardarMenu")',
                    data: { menuid: menuid,ruta:menuid },
                    cache: false,
                    beforeSend: () => {

                    },
                    success: (data) => {
                        if (data.exito) {

                            $('#modalAyudaAvatar1').modal('hide');
                            $('#modalSeguimiento').modal('show');
                            $('#modalSeguimiento').modal({backdrop: 'static', keyboard: false})
                            sut.Sede.listarayuda();

                        }
                    },
                    error: (result) => {
                        sut.error.show('mensajes', result.responseText);
                    },
                    statusCode: {
                        203: () => { window.location.reload(); }
                    }
                });

            },
            visualizar: function (valor) {
                if(valor==0){
                    window.location = '@Url.Content("~/Simplificacion/Sede/Lista")';
                } else  if(valor==1){
                    window.location = '@Url.Content("~/Simplificacion/Sede/Listagrupado")';
                }

            },
            listarayuda: function () {

                $.ajax({
                    type: 'POST',
                    //url: '/Seguridad/Portada/EnviarAutorizacionMef',
                    url: '@Url.Content("~/Seguridad/Portada/GenerarListamenulista")',
                    data: {},
                    dataType: 'json',
                    beforeSend: function () {
                        $("#mensajes").hide();
                        sut.wait.appendProgress('.modal-footer');
                    },
                    complete: function () {
                        sut.wait.removeProgress('.modal-footer');
                    },
                    success: function (result) {
                        $('#modal-ventana').modal('hide');

                        var count = 1;
                        var countejecutar = 1;
                        var i=0;
                        var recorerr = 0;

                        debugger;
                        var rows = '';
                        var asdas= result.cantidad;
                        $('#colorNav').remove();

                        rows += '<nav id="colorNav" style="text-align:left;">'
                        rows += '<ul>'
                        for (i = recorerr; i < result.cantidad; i++)
                        {
                            if (result.menu[i].MenuId == 20)
                            {
                                if (@user.Sector == 80 || @user.Sector == 79)
                                {
                                    rows += '<li class="'+result.menu[i].Estilo+'" style="'+result.menu[i].Dimension+'">'
                                    rows += '<button class="pulse4-button" style="font-size:20px">'+countejecutar+'</button><br />'
                                    rows += '<span style="font-size: 15px;color: white;"> '+result.menu[i].Descripcion +'</span> <br />'
                                    rows += '<a href="'+ result.menu[i].url+'" class="'+result.menu[i].Gragico+'"></a>'

                                    rows += '<ul style="z-index:10">'

                                    for (var sub = i; sub < result.cantidad; sub++)
                                    {
                                        if (result.menu[sub].IdPadreMenu != result.menu[i].IdPadreMenu)
                                        {
                                            i = sub - 1;
                                            break;

                                        }
                                        rows += '<li style="'+result.menu[sub].Estilo+'"> <a href="'+result.menu[sub].url+'">'+result.menu[sub].Descripcion+'</a></li>'

                                    }
                                    rows += '</ul>'
                                    rows += '</li>'
                                }
                                else
                                {
                                    i = i + 1;
                                }
                            }
                            else if (result.menu[i].MenuId == 22)
                            {
                                if (@user.CodPadre == "1")
                                {
                                    rows += '<li class="'+result.menu[i].Estilo+'" style="'+result.menu[i].Dimension+'">'
                                    rows += '	<button class="pulse4-button" style="font-size:20px">'+countejecutar+'</button><br />'
                                    rows += '	<span style="font-size: 15px;color: white;"> '+result.menu[i].Descripcion+' </span> <br />'
                                    rows += '	<a href="'+result.menu[i].url+'" class="'+result.menu[i].Gragico+'"></a>'
                                    if (result.menu[i].IdPadreMenu != 0)
                                    {
                                        i = i + 1;
                                        rows += '<ul style="z-index:10">'

                                        for (var sub = i; sub < result.cantidad; sub++)
                                        {
                                            if (result.menu[sub].IdPadreMenu != result.menu[i].IdPadreMenu)
                                            {
                                                i = sub - 1;
                                                break;

                                            }
                                            rows += '<li style="'+result.menu[sub].Estilo+'" > <a href="'+result.menu[sub].url+'" > '+result.menu[sub].Descripcion+'</a></li>'

                                        }
                                        rows += '</ul>'
                                    }

                                    rows += '</li>'
                                }
                                else
                                {
                                    i = i + 1;
                                }
                            }
                            else
                            {
                                rows += '<li class="'+result.menu[i].Estilo+'" style="'+result.menu[i].Dimension+'">'
                                rows += ' <button class="pulse4-button" style="font-size:20px">'+countejecutar+'</button><br />'
                                rows += ' <span style="font-size: 15px;color: white;"> '+result.menu[i].Descripcion+' </span> <br />'
                                rows += ' <a href="'+result.menu[i].url+'" class="'+result.menu[i].Gragico+'"></a>'

                                if (result.menu[i].IdPadreMenu != 0)
                                {
                                    i = i + 1;
                                    rows += '<ul style="z-index:10">'

                                    for (var sub = i; sub < result.cantidad; sub++)
                                    {
                                        if (result.menu[sub].IdPadreMenu != result.menu[i].IdPadreMenu)
                                        {
                                            i = sub - 1;
                                            break;

                                        }
                                        rows += '<li style="'+result.menu[sub].Estilo+'"> <a href="'+result.menu[sub].url+'">'+result.menu[sub].Descripcion+'</a></li>'

                                    }
                                    rows += '</ul>'
                                }

                                rows += '</li>'
                            }
                            countejecutar = countejecutar + 1;

                        }
                        rows += '</ul>'
                        rows += '</nav>'

                        $("#colorNavContenido").append(rows);
                        document.querySelector('#nombremenu').innerText = result.nombremenu;


                    },
                    error: function (result) {
                        sut.error.show('mensajes', result.responseText);
                    }
                });

            },
            listarDetalle: function (table, page,SedeId) {
                debugger;
                table = $('#' + table);
                var model = {
                    'filtro.Sede.Nombre': $('#txtFilterNombre').val(),
                    'filtro.Sede.Direccion': $('#txtFilterDireccion').val(),
                    'filtro.SedePadreId': SedeId ,
                    'pageIndex': page,
                    'pageSize': 1000
                };

                $.ajax({
                    //url: '/Simplificacion/Procedimiento/GetAllLikePaginByTupa',
                    url: '@Url.Content("~/Simplificacion/Sede/GetAllLikePaginDetalle")',
                    type: 'GET',
                    data: model,
                    dataType: 'json',
                    beforeSend: function () {
                        sut.wait.appendProgress('#buscarProcedimiento .modal-footer');
                    },
                    success: function (data) {
                        sut.wait.removeProgress('#buscarProcedimiento .modal-footer');
                        table.data('page', page);
                        table.data('totalrows', data.totalRows);
                        sut.Sede.generardetalle(table, data.lista);
                        //if (data.totalRows == 0)
                        //    $('#tblBuscarProcedimiento tbody').append('<tr><td colspan="5" class="text-center text-bold">NO EXISTEN REGISTROS</td></td>');
                    },
                    error: function (data) {
                        sut.error.show('mensajes', data.responseText);
                    }
                });
            },
            generardetalle: function (table, lista) {
                debugger;
                var tabla = table.children('tbody');
                tabla.children('tr').remove();
                var rows = '';
                var numero = (table.data('pagesize') * table.data('page')) - table.data('pagesize');
                $.each(lista, function (i, r) {

                    //if (multi)
                    //{
                    //    rows += sut.string.format('<tr class="rowselect" ><td><input id="chkbuscarProcedimiento{0}" type="checkbox" onclick="codigocapturar('+r.SedeId+')"  value="{0}|{3}" /></td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td></tr>',
                    //        r.TipoSede,   r.Nombre, r.Ubigeo, r.Direccion, r.ListaUndOrganica, r.Horario);
                    //} else {
                    rows += sut.string.format('<tr class="rowselect" ><td><a class="btn btn-danger btn-xs" data-placement="left" title="Eliminar" href="javascript:sut.Sede.eliminarsedegrupo({0})"><i class="fa fa-close"></i></a></td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td><td>{6}</td></tr>',
                              r.SedeGrupoId,  r.TipoSede,   r.Nombre, r.Ubigeo, r.Direccion, r.ListaUndOrganica, r.Horario);
                    //}
                });
                sut.pagination.update(table);
                tabla.append(rows);

                //if (multi) {
                //    $('.icheck-procedimiento').iCheck({
                //        checkboxClass: 'icheckbox_square-red',
                //        radioClass: 'iradio_square-red',
                //        increaseArea: '20%' // optional
                //    });
                //}
            },
            listarAcordion: function (page) {
                debugger;
                table = $('#tblLista');
                var model = {
                    'filtro.Nombre': $('#txtFilterNombre').val(),
                    'filtro.Direccion': $('#txtFilterDireccion').val(),
                    pageIndex: page,
                    pageSize: 100
                };
                $.ajax({
                    //url: "/Seguridad/Ayuda/GetAllLikePaginAcordion",
                    url: '@Url.Content("~/Simplificacion/Sede/GetAllLikePaginByTupaxidFiltro")',
                    type: "GET",
                    data: model,
                    dataType: "json",
                    beforeSend: function () {
                        sut.wait.appendOverlay('#boxLista');
                    },
                    success: function (data) {
                        debugger;
                        sut.wait.removeOverlay('#boxLista');
                        sut.Sede.generaracordion(data.lista);
                    },
                    error: function (data) {
                        sut.error.show('mensajes', data.responseText);
                    }
                });
            },

            generaracordion: function (lista) {
                debugger;
                var numero = 1;
                var numero2 = 1;
                $.each(lista, function (i, r) {
                    var rows = '';
                    rows += ('<div class="col-xs-12">');
                    rows += ('<div class="panel panel-default ">');
                    rows += ('         <div class="panel-heading" class="callout callout-warning" style="height: inherit;padding: inherit;display: block;">');
                    rows += ('             <h4 class="panel-title">');
                    rows += sut.string.format('  <br> <a class="btn btn-success"  style="color: white;" href="javascript:sut.Sede.Agregar({0})"><i class="fa fa-plus"></i> Agregar</a> ',r.SedeId);
                    rows += sut.string.format('       <a data-toggle="collapse" data-parent="#accordion" class="datos_edit" href="#collapse{0}">', ++numero);
                    rows += ( '<br><br> <b>Tipo :</b> ' +r.TipoSede);
                    rows += ( '<br> <b>Nombre Sede:</b>  ' +r.Nombre);
                    rows += ( '<br> <b>Distrito-Provincia-Departamento	:</b>  ' +r.Ubigeo);
                    rows += ( '<br> <b>Dirección	:</b>  ' +r.Direccion);
                    rows += ( '<br> <b>Recepción Documentaria		:</b>  ' +r.ListaUndOrganica);
                    rows += ( '<br> <b>Horario de atención			:</b>  ' +r.Horario);
                    rows += ('                 <br></a>');
                    rows += ('             </h4>');
                    rows += ('         </div>');
                    if (numero2 == 1) {
                        rows += sut.string.format('         <div id="collapse{0}" class="panel-collapse collapse  in">', ++numero2);
                    } else { rows += sut.string.format('         <div id="collapse{0}" class="panel-collapse collapse  ">', ++numero2);}
                    rows += ('             <div class="panel-body">');
                    rows += sut.string.format('<input type="hidden" id="valor" />');


                    //rows += (r.contenido)+'rge';

                    rows += ('<table  id="tblBuscarProcedimiento'+r.SedeId+'"');
                    rows += ('	   class="table table-bordered table-striped table-hover"');
                    rows += ('	   data-pagesize="10000"');
                    rows += ('	   data-page="1"');
                    rows += ('	   data-totalrows="0"');
                    rows += ('	   data-function=sut.Sede.listarDetalle');
                    rows += ('	   data-paginator="paginator">');
                    rows += ('	<thead>');
                    rows += ('		<tr>');
                    rows += ('			<th class="colCheck">');
                    rows += ('			</th>');
                    rows += ('			<th>Tipo</th>');
                    rows += ('			<th> Nombre</th>');
                    rows += ('			<th>Distrito-Provincia-Departamento	</th>');
                    rows += ('			<th>Dirección</th>');
                    rows += ('			<th>Recepción Documentaria	</th>');
                    rows += ('			<th>Horario de atención		</th>');
                    rows += ('		</tr>');
                    //rows += ('		<tr>');
                    //rows += ('			<th><button type="button" class="btn btn-default btn-xs" title="Borrar Filtros" data-toggle="tooltip" data-placement="right"><i class="fa fa-filter"></i></button></th>');
                    //rows += ('			<th></th>');
                    //rows += ('			<th><input name="Entidad" type="text" class="form-control input-sm" /></th>');
                    //rows += ('				<th></th>');
                    //rows += ('			<th><input name="Denominacion" type="text" class="form-control input-sm" /></th>');
                    //rows += ('		</tr>');
                    rows += ('	</thead>');
                    rows += ('	<tbody></tbody>');
                    //rows += ('	<tfoot>');
                    //rows += ('		<tr><td colspan="7"><div id="paginator"></div></td></tr>');
                    //rows += ('	</tfoot>');
                    rows += ('</table>');



                    rows += ('             </div>');
                    rows += ('         </div>');
                    rows += ('</div>');
                    rows += ('</div>');
                    $('#accordion').append(rows);

                    sut.Sede.listarDetalle('tblBuscarProcedimiento'+r.SedeId+'', 1,r.SedeId);
                });




            },
        };

        $(function () {


            if (@ViewBag.TipoSede == 1)
            {
                sut.Sede.listar(1);
            }else{

                sut.Sede.listarAcordion(1);
            }
            $('#txtFilterNombre, #txtFilterDireccion').keypress(function (e) {
                var key = e.keyCode || event.keyCode;
                if (key == 13) sut.Sede.listar(1);
            });
            $('#tblLista thead button').click(function (e) {
                $('#txtFilterNombre').val('');
                $('#txtFilterDireccion').val('');
                sut.Sede.listar(1);
            });




            /*desarrollo de la ayuda*/
            /*minimizar un modal*/

            var $content, $modal, $apnData, $modalCon;

            $content = $(".min");


            //To fire modal
            $(".mdlFire").click(function (e) {
                debugger;
                e.preventDefault();

                var $id = $(this).attr("data-target");

                $($id).modal({ backdrop: false, keyboard: false });

            });

            debugger;

            if(@user.Ayuda==1){
                $('#edit-fase-preparatoria').addClass('active');
                $('a[href="#edit-fase-preparatoria"]').parent().addClass('active');


                $('#tituloocultar').hide();


                $('#modalAyudaAvatar1').modal({backdrop: 'static', keyboard: false})
                $modal = "#modalAyudaAvatar1"
                $($modal).toggleClass("min");
                $modal = "#modalAyudaAvatar1";
                $(".modal-backdrop").addClass("display-none");
                $(".minmaxConayuda").append($apnData);
                $(".modal").css({
                    backgroundColor: "transparent"
                });

            }



            /*fin*/

            $(".modalMinimize").on("click", function(){
                debugger;
                $modalCon = $(this).closest(".mymodal").attr("id");
                $apnData = $(this).closest(".mymodal");
                $modal = "#" + $modalCon;
                $(".modal-backdrop").addClass("display-none");

                $($modal).toggleClass("min2");
                if ( $($modal).hasClass("min2") ){
                    $('#tituloocultar').show();
                    $(".minmaxCon").append($apnData);
                    //$(this).find("i").toggleClass( 'fa-minus fa-2x').toggleClass( 'fa-clone fa-2x');
                    $(".modal").css({
                        backgroundColor: "transparent"
                    });
                }
                else {
                    $('#tituloocultar').hide();
                    $(".minmaxConayuda").append($apnData);
                    //$(this).find("i").toggleClass( 'fa-clone fa-2x').toggleClass( 'fa-minus fa-2x');
                    $(".modal").css({
                        backgroundColor: "transparent"
                    });
                };
            });




        });
    </script>
}
